\documentclass[reqno]{amsart}
%\usepackage[english]{babel}
\usepackage[all,cmtip]{xy}
\usepackage{amssymb,amsmath,mathrsfs,amsthm,amscd,hyperref,amsfonts,graphicx}
\usepackage[all]{xy}
\bibliographystyle{plain}
\oddsidemargin 0mm
\evensidemargin 0mm
\textheight 214mm \textwidth 160mm
\headsep 10mm
\raggedbottom



\newtheorem{thm}{Theorem}[section]
\newtheorem{theorem}{Theorem}[section]
%\newtheorem{defn}[thm]{Definition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{conj}[thm]{Conjecture}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{proposition}[thm]{Proposition}
\newtheorem{nota}[thm]{Notation}
%\newtheorem{rem}[thm]{Remark}

\theoremstyle{definition}
\newtheorem{rem}[thm]{Remark}
\newtheorem{remark}[thm]{Remark}
\newtheorem{defn}[thm]{Definition}
\renewcommand{\thedefn}{}

\theoremstyle{remark}
\newtheorem{ex}{Example}
\newtheorem{notation}{Notation}
\newtheorem{exs}{Examples}
\renewcommand{\theex}{}
\renewcommand{\thenotation}{}
\renewcommand{\theexs}{}



%\theoremstyle{plain}
%\newtheorem{thm}[equation]{Theorem}
%\newtheorem{prop}[equation]{Proposition}
%\newtheorem{cor}[equation]{Corollary}
%\newtheorem{lemma}[equation]{Lemma}
%\newtheorem{conj}[equation]{Conjecture}

%\theoremstyle{definition}
%\newtheorem{defn}[equation]{Definition}
%\newtheorem{defns}[equation]{Definitions}
%
%\theoremstyle{remark}
%\newtheorem{rem}[equation]{Remark}
%\newtheorem{rems}[equation]{Remarks}
%\newtheorem{exer}[equation]{Exercise}
%\newtheorem{exers}[equation]{Exercises}
%\newtheorem{rem-exer}[equation]{Remark/Exercise}
%\newtheorem{rem-exers}[equation]{Remark/Exercises}
%\newtheorem{ex}[equation]{Example}
%\newtheorem{exs}[equation]{Examples}

\DeclareMathOperator{\dvsr}{div}
\newcommand{\one}{{\bf 1}}
\newcommand{\Div}{\operatorname{Div}}
\newcommand{\divi}{\operatorname{div}}
\newcommand{\sep}{\operatorname{sep}}
\newcommand{\XminusT}{(x-T)}
\newcommand{\xminusT}{(x-T)'}
\newcommand{\GG}{\mathcal{G}}
\newcommand{\iso}{\stackrel{\sim}{\rightarrow}}
\newcommand{\val}{\operatorname{val}}
\newcommand{\pr}{\operatorname{pr}}
\newcommand{\rk}{\operatorname{rank}}
\newcommand{\sy}{\bar{y}}
\newcommand{\vd}{\mathbf{d}}
\newcommand{\ve}{\mathbf{e}}


\def\bmu{{\boldsymbol\mu}}

\def \PP {{\mathbb P}^1}
\def \ZZ {{\mathbb Z}}
\def  \FF {{\mathbb F}}
\def \car {\mathop {\rm Car}}

\def\genus{\textrm{genus}}
\def\cond{\textrm{cond}}
\def\R{\mathbb{R}}
\def\Gal{\textrm{\upshape Gal}}
\def\ord{\textrm{\upshape ord}}
\def\p{\mathbb{P}}
\def\C{\mathbb{C}}
\def\Q{\mathbb{Q}}
%\def\A{\mathbf{A}}
\def\QQ{\overline{\mathbb{Q}}}
\def\Z{\mathbb{Z}}
\def\m{\mathfrak{m}}
\def\Oo{\mathcal{O}}
\def\F{\mathbb{F}}
\def\Hom{\mathrm{Hom}}
\def\tor{\mathrm{tor}}
\def \End{\mathrm{End}}
\def\hh{\textrm{H}}
\def\s{\textrm{\upshape Spec}\,}
\def\Br{\textnormal{Br}}
\def\pr{\textnormal{pr}}
\def\Nm{\textnormal{Nm}}
\def\can{\textnormal{can}}
\def\rank{\textnormal{rank}}
\def\Pic{\textnormal{Pic}}
\def\h{\textnormal{H}}
%\def\PGL{\textnormal{PGL}}
\def\torsion{\textnormal{tors}}
\def\tors{\textnormal{tors}}


% provide the letter sha:
\usepackage[OT2,T1]{fontenc}
\DeclareSymbolFont{cyrletters}{OT2}{wncyr}{m}{n}
\DeclareMathSymbol{\sha}{\mathalpha}{cyrletters}{"58}

\def\JJ{\mathcal{J}}
\def\XX{\mathcal{X}}
\newcommand{\sxi}{\mathcal{X}_\infty}
\def\YY{\mathcal{Y}}
\def\O{\mathcal{O}}
\def\OO{\mathcal{O}}



% abbreviations/alternate names
\def\<{\langle}
\def\>{\rangle}
\def\into{\hookrightarrow}
\def\onto{\twoheadrightarrow}
\def\isoto{\tilde{\to}}
\def\tensor{\otimes}
\def\compose{\circ}
\def\sdp{{\rtimes}}
\def\nodiv{\not|}
\def\PGL{\mathrm{PGL}}
\def\PSL{\mathrm{PSL}}
\def\SL{\mathrm{SL}}
\def\GL{\mathrm{GL}}
\def\Sp{\mathrm{Sp}}
\def\P{\mathbb{P}}

\def\ker{\text{ker}}
\def\im{\text{im}}

\DeclareMathOperator{\res}{Res}
\DeclareMathOperator{\spec}{Spec}

\def\sce{\mathscr{C}^{\textsf{ex}}}
\def\scd{\mathscr{C}}
\def\caff{C_{\textsf{aff}}}
\def\sj{\mathscr{J}}
%\def\sA{\ensuremath{\mathscr{A}}}
\def\sO{\mathcal{O}}
%\def\sO{\ensuremath{\mathscr{O}}}
%\def\sL{\ensuremath{\mathscr{L}}}
%\def\sK{\ensuremath{\mathscr{K}}}
%\def\sF{\ensuremath{\mathscr{F}}}
\def\Pro{\ensuremath{\mathbb{P}}}
%\def\sG{\mathscr{G}}
%\def\sX{\mathscr{X}}
%\DeclareMathOperator{\Supp}{Supp}
%\DeclareMathOperator{\Div}{Div}
%\DeclareMathOperator{\dv}{div}
%\DeclareMathOperator{\Pic}{Pic}
%\DeclareMathOperator{\P0}{Pic^0}
%\DeclareMathOperator{\Spec}{Spec}
\def\isom{\cong}


\begin{document}
\title[Explicit Unbounded Ranks]{Explicit Unbounded Ranks}
\author[Explicit Unbounded Ranks]{L.\ Berger}
\address{}
\email{}
\author[]{C.\ Hall}
\address{}
\email{}
\author[]{R.\ Pannekoek}
\address{}
\email{}
\author[]{J.\ Park}
\address{}
\email{}
\author[]{R.\ Pries}
\address{}
\email{}
\author[]{S.\ Sharif}
\address{}
\email{}
\author[]{A.\ Silverberg}
\address{Department of Mathematics, UC Irvine, Irvine, CA 92697, USA}
\email{asilverb@math.uci.edu}
\author[]{D.\ Ulmer}
\address{School of Mathematics, Georgia Institute of Technology, Atlanta, GA 30332, USA}
\email{ulmer@math.gatech.edu}
\thanks{This material is based upon work supported by the 
National Science Foundation under grants....  We thank Karl Rubin and Yuri G.\ Zarhin for
help. We thank AIM....}

%\date{\today}

\begin{abstract}  
to appear
\end{abstract}


\maketitle

\section{Introduction}

\section{Statements of Main Results}

Let $p$ be an odd prime and let $r \ge 2$ be an integer not divisible by $p$.
Let $C$ be the smooth projective curve over $\F_p(t)$ of genus $g:=r-1$ with affine model
\[ C : y^r=x^{r-1}(x+1)(x+t).\]
Let $J$ be the Jacobian variety of $C$. Then $J$ is an abelian variety
over $\F_p(t)$ of dimension $g=r-1$. The automorphism
$(x,y) \mapsto (x,\zeta_r y)$ of $C$ induces an injection
$\Z[\zeta_r] \hookrightarrow\End(J)$.

When $r=2$, all the results were proved earlier by Ulmer in \cite{Legendre}.

\begin{thm}
\label{fullBSDthm}
The full Conjecture of Birch and Swinnerton-Dyer holds for
$J$ over $\F_q(t^{1/d})$, for all $d$ and for all $q=p^a$. 
\end{thm}


From now on, suppose further that $r$ is a prime divisor of $d$ 
and that $d$ is of the form $d=p^f+1$ for some $f\in\Z^+$.
Let
$$u=t^{1/d}, \qquad
K_d=\F_p(\bmu_d,u).$$

The restriction that $r \mid (p^f+1)$ for some $f$ is 
equivalent to the order of $p$ mod $r$ being even, which is
equivalent to $-1 \in \langle p \rangle \subset (\Z/r\Z)^\times$. 
For each $r$, this gives at least half the primes $p$. 
%Later we'll see a different example without this restriction.




\begin{thm}
\label{rkthm}
\[
\rank_\Z J(K_d) = (r-1)(d-2).
\]
\end{thm}


Let  %let $P_{0,0} := (u, u(u+1)^{d/r})$, and more generally let   
\[
P_{i,j} := (\zeta_d^i u, \zeta_d^{jd/r + i}u(\zeta_d^i u+1)^{d/r}) \in C(K_d)
\]
where $i$ is viewed modulo $d$, and $j$ modulo $r$, %,
%i.e., consider $P_{0,0} = (u, u(u+1)^{d/r})$ and its image under
%the action of the Galois group $\Gal()$.
let $Q_\infty \in C(K_d)$ denote the point at infinity,
and let
\[
D_{i,j} := [P_{i,j}] - [Q_\infty] \in J(K_d).
\]

\begin{thm}
\label{Dijgenthm}
The $dr$ divisors $D_{i,j}$ generate a subgroup of $J(K_d)$ of finite index.
\end{thm}

%\begin{proof}
%
%(Sketch)
%We compute the dimension of the image of $\langle D_{i,j} \rangle$
%under the $(\zeta_r-1)$-descent map (Poonen-Schaefer's 
%$(x-T)$ map):
%\begin{multline*}
%(x-T) : J(K_d)/(\zeta_r-1)J(K_d) \hookrightarrow H^1(K_d,J[\zeta_r-1])
%\\
%\isom \left[ \left( K_d[T]/(T(T+1)(T+t))\right)^\ast/\left(\ldots\right)^r \right]_1
%\isom \left[ \left(K_d^\ast/(K_d^\ast)^r\right)^3 \right]_1
%\end{multline*}
%$$
%(x,y) \in C(K_d) \mapsto (x,x+1,x+t)
%$$
%where $[\,\cdot\,]_1$ denotes the kernel of the weighted norm map
%$$(x,y,z)\mapsto x^{r-1}yz = yz/x \in K_d^\ast/(K_d^\ast)^r.$$
%
%
%\begin{multline*}
%\rank_{\Z[\zeta_r]} J(K_d) = 
%\dim_{\F_r} J(K_d)/(\zeta_r-1) - \dim_{\F_r} J(K_d)_\tors/(\zeta_r-1) \\
%\ge \dim_{\F_r} ((x-T)(\langle D_{i,j} \rangle)) - 2 = d-2
%\end{multline*}
%%A (mostly linear algebra) computation 
%giving
%$$
%\rank_\Z J(K_d) = (r-1)\rank_{\Z[\zeta_r]} J(K_d) \ge (r-1)(d-2).
%$$
%  
%Then
%\begin{align*}
%(r-1)(d-2) & \le \text{rank} \\
%& \le \text{($=$ with BSD) analytic rank} \\
%& \le \text{degree of $L$-function} \\
%& = (r-1)(d-2)
%\end{align*}
%giving a different proof of BSD.
%
%\bigskip 
%
%A sketch of the proof of the last equality is as follows:
%  
%Combining work of Raynaud, Ulmer, Milne, Hall, and others, one gets
%that the degree of the $L$-function is
%$$
%-4\dim(J) + \deg(\cond(J[\ell]))$$
%for any prime $\ell \nmid 2pr$, and
%$$
%\cond(J[\ell]) = 
%\sum_{x\in\P^1}(t_x + 2u_x)[x]
%$$
%where $t_x$ is the dimension of the toric part of the special fiber (over $x$)
%of the N\'eron model of $J$,
%and $u_x$ is the dimension of the unipotent part.
%  
%We compute that the reduction of $J$ at $u=0$ and $u=\infty$
%is totally multiplicative and the reduction at the $d$ places
%$u^d=1$ is half good and half additive.
%Thus,
%$$
%\deg(\cond(J[\ell])) = 
%\sum_{x\in\P^1}(t_x + 2u_x) = 
% (r-1) + (r-1) + d\cdot 2\cdot \frac{r-1}{2} = (r-1)(d+2)
%$$
%so
%$$
%\deg(L\text{-function}) = -4\dim(J) + %\deg(\cond(J[\ell])) 
%\sum(t_x + 2u_x) =  
%-4(r-1)+(r-1)(d+2) 
%= (r-1)(d-2).
%$$
%\end{proof}



Let $o_q(e)$ denote the order of $q$ in $(\Z/e\Z)^\times$.


\begin{thm}
\label{smallerfldthm}
Let $t=o_q(r)$. Then:
\begin{enumerate}
\item[(i)]
$\rank_\Z J(\F_q(\bmu_r,t^{1/d})) = (r-1)\left[\sum_{e\mid d}\frac{\varphi(e)}{o_{q^t}(e)}-
2 \right]$,
\item[(ii)]
$\rank_\Z J(\F_q(t^{1/d})) = {\frac{r-1}{t}}\left[\sum_{e\mid d}\frac{\varphi(e)}{o_{q^t}(e)}-
2 \right]$,
\item[(iii)]
over (fixed) $\F_q(u)$, Jacobians of curves of genus $r-1$ have unbounded rank.
\end{enumerate}
\end{thm}


\begin{thm}
\label{torsionthm}
As $\Z[\zeta_r]$-modules,
\[
J(K_d)_{\textup{tors}} \cong \Z[\zeta_r]/(\zeta_r-1) \times \Z[\zeta_r]/(\zeta_r-1)^2.
\]
\end{thm}

It follows that as abelian groups,
$$
J(K_d)_{\torsion} \cong 
\begin{cases}
(\Z/r\Z)^3 & \text{if $r>2$}, \\
\Z/2\Z \times \Z/4\Z & \text{if $r=2$}.
\end{cases}
$$

In particular,
$$
J(K_d)_{\torsion} =J(K_d)[r^\infty]
$$
and
$$
J(K_d)[\ell] = 0
$$
for all primes $\ell \neq r$.

%\begin{proof}
%
%(Sketch)
%Let $Q_0=(0,0), Q_1=(-1,0), Q_t=(-t,0)$. 
%Then $[Q_i] - [Q_\infty]$
%are $(\zeta_r-1)$-torsion points for $i=0,1,t$, and
%$[Q_0] - [Q_\infty]$ is in the kernel of the $(\zeta_r-1)$-descent map.
%
%We found a divisor $D\in \langle D_{i,j} \rangle$ such that
%$$
%(\zeta_r-1)D \sim [Q_0] - [Q_\infty].
%$$
%
%We show that the $\F_r$-dimension of the image of the known $(\zeta_r-1)^\infty$-torsion 
%under the $(\zeta_r-1)$-descent map is $2$; this shows we have all of it. 
%It's generated over $\Z[\zeta_r]$ by $[Q_1] - [Q_\infty]$ and $D$, so
%$$
%J(K_d)[r] \cong \Z[\zeta_r]/(\zeta_r-1) \times \Z[\zeta_r]/(\zeta_r-1)^2.
%$$
%To show
%$$
%J(K_d)[\ell] = 0
%$$
%for all $\ell \nmid 2pr$, we use the geometry of the N\'eron model and group theory to 
%understand the image of the mod $\ell$ representation
%$$
%\Gal(\bar{\F}_q(t)(J[\ell])/\bar{\F}_q(t)) \hookrightarrow \GL_{2(r-1)}(\F_\ell).
%$$
%
%We show $J(L)[\ell]=0$ for all solvable extensions $L$ of $\bar{\F}_q(t)$.
%
%To show
%$$
%J(K_d)[p] = 0,
%$$
%we show that $J$ is ordinary, i.e.,
%$$
%\# J(\overline{\F_q(t)})[p]=p^{r-1},
%$$
%and calculate the Kodaira-Spencer map to show that
%$$
%J({\F_p(t)}^{sep})[p]=0.
%$$
%
%To show
%$$
%J(K_d)[2] = 0:
%$$
%
%Use that $C$ is isomorphic to the hyperelliptic curve
%\begin{align*}
%y^2 & = x^{2r} - 2(t+1)x^r + t^2-2t+1  \\
%& = (x^r-(u^{d/2}+1)^2)(x^r-(u^{d/2}-1)^2).
%\end{align*}
%\end{proof}



\begin{thm}
\label{decompthm}
If $r>2$, then there is an $(r-1)/2$-dimensional absolutely simple abelian variety $B$ with real multiplication by $\Q(\zeta_r)^+$ such that $J$ is isogenous to $B^2$.
\end{thm}

\begin{thm}
\label{endothm}
If $r>2$, then
\begin{align*}
\End(J) \otimes_\Z \Q &\cong M_2(\Q(\zeta_r)^+) \\
\End_{\bar{\F}_q(t)}(J)\otimes_\Z\Q &\cong \Q(\zeta_r).
\end{align*}
\end{thm}

%\begin{proof}
%
%(Sketch)
%Consider the involution
%$$\sigma : (x,y) \mapsto (-1-\frac{t-1}{x+1},\frac{(t-1)^{2/r}}{y}).$$
%There is an isogeny 
%$$J\sim\ker(\sigma-1) \times\im(\sigma-1) \sim B^2.$$
%%for the involution
%%$$\sigma : (x,y) \mapsto (-1-\frac{v^r}{x+1},\frac{v^2}{y})$$
%%where $v^r=t-1$,
%
%We use group theory to show that $B$ is absolutely simple and
%has endomorphism algebra $\Q(\zeta_r)^+$.
%\end{proof}
%
%
%[We need to reconcile the notation in the next result.]

\begin{thm}
\label{Lfnthm}
Letting $q_1=|\F_q(\bmu_d)|$, then
\begin{align*}
L(J/\F_q(t),s) &= 1,
\\
L(J/K_{d},s) &= (1 - q_1^{1-s})^{(r-1)(d-2)},
\end{align*}
i.e., with $T=q_1^{-s}$ we have
\[
L(T,J/K_d) = (1-q_1T)^{(r-1)(d-2)}\in\Z[T].
\]
\end{thm}


%\begin{proof}
%
%(Sketch)
%This follows since we showed that
%$$
%\deg(L(T,J/K_d)) = (r-1)(d-2)  = \rank_\Z J(K_d) = \text{analytic rank}
%$$
%and we can similarly show that $\deg(L(T,J/\F_q(t)))=0$.
%\end{proof}

\begin{lem}
The genus of $C$ is $r-1$.
\end{lem}

\begin{proof}
This follows by applying the Riemann-Hurwitz theorem to the 
$x$-coordinate map from the smooth proper model of $C$ to $\P^1$. 
The map is an $r$-fold cover ramified at 4 points, each with ramification index $r$.
\end{proof}



\section{Hyperelliptic model and $2$-torsion}


\begin{lem}
The curve $C$ is isomorphic to the hyperelliptic curve
$$
Y^2=X^{2r}-2(t+1)X^r+(t^2-2t+1).
$$
\end{lem}

\begin{proof}
The change of coordinates
$x=(Y+X^r+t+1)/2$ and $y=xX$ transforms
$C$ to the isomorphic curve  
$$Y^2 + 4(t+1)Y + (3t^2+10t+3)=X^{2r}-2(t+1)X^r.$$
Completing the square, via the substitution $Y \mapsto Y - 2(t+1)$, gives 
the hyperelliptic curve
\begin{equation}
\label{HEC}
Y^2=X^{2r}-2(t+1)X^r+(t^2-2t+1) = (X^r-(u^{d/2}+1)^2)(X^r-(u^{d/2}-1)^2)
\end{equation}
where $u=t^{1/d}$.
\end{proof}



\begin{lem}
If $r$ is an odd prime, $q$ is an odd prime power, $d$ is even, and $K_d=\F_q(\bmu_d,u)$,
then $J(K_d)[2]=0$.
\end{lem}

\begin{proof}
Since $d$ is even and $r$ is an odd prime, the two factors on the right hand side of
\eqref{HEC} are irreducible polynomials in $K_d[X]$.
Lemma 12.9 of \cite{ps} implies that if $k$ is a field of odd degree,
$f(X)$ has $n$ distinct irreducible factors over $k$, and at least one 
of these factors has odd degree,
then the $2$-torsion over $k$ on the Jacobian variety of $Y^2=f(X)$ has 
dimension $n-2$. 
Applying this to \eqref{HEC} with $k=K_d$ gives
$J(K_d)[2]=0$.
\end{proof}


\section{Conjecture of Birch and Swinnerton-Dyer}

Recall:

\begin{conj}[BSD I]
%The rank equals the analytic rank:
$$\rank_\Z J(K) = \ord_{s=1}L(J,s)$$
\end{conj}

\begin{conj}[BSD II]
As $s \to 1$,
$$
L(J,s) \sim \frac{R|\sha|\tau}{|J(K)|^2_{\tors}}(s-1)^r
$$
where $r$ is the analytic rank,
$R$ is the regulator, $\sha$ is the Tate-Shafarevich group, and
$\tau$ is the Tamagawa number.
\end{conj}
For function fields it is known that $\rank_\Z J(K) \le \ord_{s=1}L(J,s)$
and that BSD I$\implies$BSD II, by Tate, Milne, \ldots, Kato, Trihan.

\begin{thm}
%\label{fullBSDthm}
The full Conjecture of Birch and Swinnerton-Dyer holds for
$J$ over $\F_q(t^{1/d})$, for all $d$ and for all $q=p^a$. 
\end{thm}

\begin{proof}

[references needed below]
The curve $C$ is isomorphic to $y^r = \frac{(x+1)(x+t)}{x}$.
Let
$$
C_d : \beta^d = \alpha^r - 1,
$$
$$
D_d : \delta^{-d} = \gamma^r - 1.
$$
Then 
$$
\xymatrix{C_d \times D_d~ \ar@{-->}[r]& ~y^r = \displaystyle\frac{(x+1)(x+u^d)}{x}}
$$ 
$$
(\alpha,\beta,\gamma,\delta) \mapsto (x,y,u) = (\alpha^r-1, \alpha\gamma, \beta/\delta)
$$
Thus, the surface
$y^r =(x+1)(x+u^d)/x$ over $\F_q$ 
is dominated by a product of curves $C_d \times D_d$.

The Tate Conjecture for the surface then follows,
and this in turn implies (full) BSD for the
Jacobian of the curve $y^r =(x+1)(x+u^d)/x$ over $\F_q(u)$,
for all $q=p^a$.

This gives (full) BSD for $J$ over $\F_q(t^{1/d})$,
for all $q=p^a$ and all $d$.
\end{proof}

\section{$L$-functions}
%Chris
[Chris will supply this. Below is a place holder.]

Under the given conditions, the degree of the $L$-function is indeed $(r-1)(d-2)$.
Let $L/K$ be a finite extension and $C/k$ be a smooth projective curve with $K=k(C)$.
Let $J\dashrightarrow C$ be the Neron model of $J/L$ and $t_x$ and $u_x$ be the dimensions of, respectively, the toric and unipotent parts of the special fiber of $J\dashrightarrow C$ over a closed point $x$ of $C$.  Let $G_\ell$ be the Galois group of $K(J[\ell])/K$ and $I(x)\subset G_\ell$ be the inertia group of some point/prime over $x$.  If $\ell$ is odd, then the (tame) conductor of $J[\ell]$ is the divisor
$$\cond(J[\ell]) = \sum_x \dim(J[\ell]/J[\ell]^{I(x)})[x] = \sum_x (t_x+2u_x)[x].$$
Theorem 2.12 on p.~190 of Milne's Etale Cohomology together with section 6.2.1 of the attached preprint by Ulmer imply that
$$\deg(L(T,J/L) \mod \ell) = 4\dim(J)(\genus(C)-1) + \deg(\cond(J[\ell])).$$
For us, $C=\P^1$ and $L=K_d$.
If we take $d$ a multiple of $r$, then we can show that 
the reductions at $u=0,\infty$ are totally multiplicative,
and the reduction at the $d$ places $u^d=1$ is half good and half additive.
%All of this is deducible from Chris's old document (e.g. in section 1.3).  
The degree of the $L$-function then becomes
$$\deg(L(T,J/L))
=\deg(L(T,J/L) \mod \ell) =  -4(r-1) + 2(r-1) + d(r-1) = (d-2)(r-1).$$



\section{The descent map}

Let $q$ be a power of a prime $p$ and let $K$ be the rational function field $\F_q(t)$. For each integer $d>1$, define $K_d = K(\zeta_d,t^{1/d})$, where $\zeta_d$ is a primitive $d$-th root of unity, and $u = t^{1/d}$. The field extension $K(\zeta_d) \subset K_d$ is cyclic of degree $d$, for all $d$.

\subsection{A superelliptic curve.}

Choose an odd prime $r$ not dividing $q$. We will consider the smooth projective curve $C$ over $K$ associated to the affine equation
\begin{equation}
\label{equationOfC}
y^r = x^{r-1}(x+1)(x+t),
\end{equation}
whose projective closure in $\p^2_K$ is given by
$$
C' : Y^rZ = X^{r-1}(X+Z)(X+tZ).
$$
The curve $C'$ is non-singular at the unique point at infinity $Q_{\infty} = (0:1:0)$. Choose an integer $\nu$ and set $d = q^\nu+1$. We define
$$
P_{i,j} = \left( \zeta_d^i t^{1/d}, \zeta_d^{jd/r+i} t^{1/d} ( \zeta_d^i t^{1/d}+1 )^{d/r}  \right).
$$ 
for $0 \leq i \leq d-1$ and $0 \leq j \leq r-1$. Now assume that $r$ divides $d$. Then one verifies that $P_i$ is an element of $C(K_d)$ for each $i$. Let $J$ be the Jacobian of $C$.

Using descent, we will prove the following theorem.

\begin{theorem}
\label{subgoal}
The divisor classes $[P_{i,j}] - [Q_{\infty}]$ generate a subgroup of $J(K_d)$ of rank $(r-1)(d-2)$. Moreover, we have $J(K_d)[r^{\infty}] \cong (\Z/r\Z)^3$.
\end{theorem}

\begin{remark}
\upshape
In order for there to exist an integer $\nu$ such that $d = q^\nu+1$ is divisible by $r$, it is necessary and sufficient that $r$ is an odd prime divisor of $q^{\mu}+1$ for some integer $\mu$, and we must have $\nu = \mu \ell$ for some odd integer $\ell$. There are infinitely many $r$ that satisfy this condition, as can be seen by observing that $q^{2^a}+1$ and $q^{2^b}+1$ are coprime integers for all distinct positive integers $a$ and $b$. Since $q^\mu + 1$ divides $q^{\mu \ell}+1$ for any odd integer $\ell$, there exist infinitely many integers $\nu$ such that $d = q^\nu+1$ is divisible by $r$.
\end{remark}

The unique singular point of $C$ is $Q_0 = (0,0)$. The normalization map $C \rightarrow C'$ is a universal homeomorphism; in particular, it is bijective on $\overline{K}$-points. Let $Q_1 = (-1,0)$ and $Q_t = (-t,0)$. We denote $\Delta = \{Q_0,Q_1,Q_t\}$. We consider the covering
$$
\pi : C \rightarrow \p^1
$$
induced by the function $x$. The ramification points of $\pi$ are $Q_0,Q_1,Q_t$ and $Q_{\infty}$, each with ramification index $r$. Applying Riemann--Hurwitz gives that the genus of $C$ is $r - 1$. Note that $C_{K_d}$ has an automorphism given by $(x,y) \mapsto (x,\zeta_d^{d/r} y)$; we denote this automorphism by $\zeta_r$. The automorphism $\zeta_r$ of $C_{K_d}$ induces an automorphism $\zeta_r$ of $J_{K_d}$. The Rosati-involution $\alpha \mapsto \alpha^{\dagger}$ on $\End(J_{K_d})$ sends $\zeta_r$ to its inverse: this simply restates the fact that $\zeta_r$ respects the polarization on $J_{K_d}$, which it does, coming from an automorphism of $C_{K_d}$. We let $\phi : J_{K_d} \rightarrow J_{K_d}$ be the endomorphism $1 - \zeta_r$.

\begin{proposition}
\label{propertiesOfPhi}
The endomorphism $\phi$ is a separable isogeny of degree $r^2$. Its kernel is generated by $[Q_0] - [Q_{\infty}]$ and $[Q_1] - [Q_{\infty}]$.
\end{proposition}
\begin{proof}
Let $g = r-1$ be the genus of $C$. We claim that the endomorphism $(1-\zeta_r)^{r-1}$ and the separable isogeny $[r]:J\rightarrow J$ factor through each other. This follows from the well-known fact from algebraic number theory that the ideal $(r)$ of the Dedekind domain $\Z[\zeta_r]$ decomposes as $(1-\zeta_r)^{r-1}$. It follows that:
$$
\deg(1-\zeta_r)^{r-1} = \deg {[r]} =  r^{2g} = r^{2(r-1)},
$$
which proves that $\deg(1-\zeta_r) = r^2$.

For the final assertion, one easily verifies that the divisor classes $D_0 = [Q_0] - [Q_{\infty}]$ and $D_1 = [Q_1] - [Q_{\infty}]$ are contained in the kernel of $\phi$. To see that the $mD_0 + nD_1$ are distinct elements of $J(K_d)$ for all pairs $(m,n)$ with $m,n \in \{0,1,\ldots,r-1\}$, and hence that $\ker(\phi)$ is generated by $D_0$ and $D_1$, it suffices to show that $x^m(x+1)^n$ is not an $r$-th power in $K_d(C)$ unless $r \mid m$ and $r \mid n$. This is a routine exercise in field theory. 
\end{proof}

\begin{lemma}
\label{rosati}
We have $J[\phi] = J[\phi^{\dagger}]$, as group schemes.
\end{lemma}
\begin{proof}
The equality comes down to the observation that the endomorphisms $\phi = 1-\zeta_r$ and $\phi^\dagger = 1-\zeta_r^{-1}$ factor through each other. But this follows from the fact that $(1-\zeta_r)/(1-\zeta_r^{-1}) \in \Z[\zeta_r]^{\ast}$.
\end{proof}

%Let $\nu$ be such that $r \mid q^{\nu}+1$, and let $d = q^{\nu}+1$. 
%Let $L = K[T]/( T(T+1)(T+t) )$, and let $\Delta = \operatorname{Spec}L$. The underlying set of $\Delta$ can be identified with the set $\{ Q_0, Q_1, Q_t \}$ of those ramification points of $\pi : C \rightarrow \p^1$ that are not at infinity. We denote the base-change $L \otimes_K K_d$ by $L_d$. We will frequently use the identification $L_d = \prod_{Q \in \Delta} K_d$ furnished by the Chinese remainder theorem.

\subsection{Some relations among divisors on $C$}

By $\sim$ we denote linear equivalence in $\Div(C_{K_d})$.

\begin{lemma}
\label{tworels}
We have the following relations in $\Div(C_{K_d})$:
\begin{equation}
\label{divy}
(r+1)Q_\infty \sim (r-1)Q_0 + Q_1 + Q_t,
\end{equation}
\begin{equation}
\label{justsum}
\sum_{i=0}^{d-1} (P_{i,0} - Q_{\infty}) \sim Q_0 - Q_1
\end{equation}
and
\begin{equation}
\label{dougsfind}
\sum_{i=0}^{d-1} (P_{i,0} - P_{i,-i}) \sim Q_0 - Q_\infty.
\end{equation}
\end{lemma}
\begin{proof}Equation (\ref{divy}) follows from considering $\divi(y) \sim 0$. We define $f,g \in K_d(C)$ as follows: $f = y - x(x+1)^{d/r}$ and $g = yx^{d/r-1} - u^{d/r} (x+1)^{d/r}$. Then (\ref{justsum}) follows from considering $\divi(f/x) \sim 0$ and (\ref{dougsfind}) follows from $\divi(f/xg)\sim 0$.
\end{proof}

\begin{lemma}
\label{newtorsion}
Define $D \in \Div(C_{K_d})$ by
$$
D = \sum_{i=0}^{d-1} \sum_{j=0}^{[-1-i]} (P_{i,j} - Q_\infty),
$$
where $[-1-i] \in \{0,\ldots,r-1\}$ is congruent to $-1-i$ modulo $r$, then
$$
(1-\zeta_r)(D) \sim Q_0 - Q_\infty.
$$
Hence the class of $D$ is a $(1-\zeta_r)^2$-torsion element of $J(K_d)$.
\end{lemma}
\begin{proof}
A straightforward calculation shows $(1-\zeta_r)(\sum_{j=0}^{[-1-i]} P_{i,j}) = P_{i,0} - P_{i,-i}$. Hence $(1-\zeta_r)(D) \sim Q_0 - Q_\infty$ follows from (\ref{dougsfind}). The last statement follows from $(1-\zeta_r)[Q_0 - Q_\infty] = 0$, as noted in Lemma \ref{propertiesOfPhi}.
\end{proof}


\subsection{The homomorphism $\XminusT$.}

We will define the pivotal homomorphism
$$
\XminusT : \Div^0(C_{K_d}) \rightarrow \prod_{Q \in \Delta} K_d^{\ast}/K_d^{\ast r}.
$$
Its properties are described in Proposition \ref{propertiesOfCC}.  For an element $v \in \prod_{Q \in \Delta} K_d^{\ast}/K_d^{\ast r}$, we conveniently write $v = (v_0,v_1,v_t)$, where $v_i$ is the coordinate corresponding to $Q_i$.

Let $C_{K_d}^\circ \subset C_{K_d}$ be the complement of $\Delta \cup \{ Q_\infty \}$. We define the homomorphism
$$
\xminusT : \Div(C_{K_d}^\circ) \rightarrow \prod_{Q \in \Delta} K_d^{\ast}/K_d^{\ast r}
$$
by 
$$
P \mapsto \left( x(P) - x(Q) \right)_{Q \in \Delta},
$$
followed by taking the norm if $P$ is defined over a proper field extension of $K_d$. 

We now define the homomorphism 
$$
\XminusT : \Div^0(C_{K_d}) \rightarrow \prod_{Q \in \Delta} K_d^{\ast}/K_d^{\ast r}
$$
as follows: let $D \in \Div^0(C_{K_d})$ be a degree-zero divisor on $C_{K_d}$, then choose $D' \in \Div(C_{K_d}^\circ)$ in such a way that $D$ is linearly equivalent to $D'$. Then set $\XminusT(D) := \xminusT(D')$. For a proof that $\XminusT$ is well-defined, see \cite[6.2.2]{bps}.


\begin{proposition}
\label{propertiesOfCC}
There exists a homomorphism $\alpha : H^1(J[\phi]) \rightarrow \prod_{Q \in \Delta} K_d^{\ast}/K_d^{\ast r}$ such that the following diagram is commutative and its bottom row is exact:
\[
\xymatrix{ 
& \Div^0(C_{K_d}) \ar@{->>}[d] \ar@/^1pc/[ddr]^{\XminusT}  \\\
& J(K_d)/\phi J(K_d) \ar@{^(->}[d]^{\partial} \\\
0 \ar[r] & H^1(J[\phi]) \ar[r]^{\alpha~~~} & \prod_{Q \in \Delta} K_d^{\ast}/K_d^{\ast r} \ar[r]^{~~~~N} & K_d^{\ast}/K_d^{\ast r} \ar[r] & 0
} 
\]
Here $\partial$ is induced by the Galois cohomology coboundary map for the isogeny $\phi$, and $N$ is the map sending $(a_0,a_1,a_t)$ to $a_1a_t/a_0$.
\end{proposition}
\begin{proof}
The proof is an application of the general theory of descent as developed in \cite{bps}. Fix a separable closure $K_d^{\sep}$ of $K_d$, and let $\GG$ be $\Gal(K_d^{\sep}/K_d)$. For a finite $\GG$-module $M$ of cardinality not divisible by $p$, we denote by $M^{\vee}$ the dual $\GG$-module $\Hom(M,K_d^{\sep \ast})$.

Let $E$ be $(\Z/r \Z )^{ \Delta }$, the $\GG$-module of $\Z/r\Z$-valued functions on $\Delta$. Note that the $\GG$-action on $\Delta$ as well as $E$ is trivial. There is a $\GG$-module map $\alpha^{\vee} : E \rightarrow J[\phi]$ 
defined by $h \mapsto \sum_{Q \in \Delta} h(Q) \cdot [Q - Q_{\infty}]$. Proposition \ref{propertiesOfPhi} shows that $\alpha^\vee$ is surjective. Its kernel $R$ is the $\Z/r\Z$-submodule of $E$ generated by the map $\rho$ defined by $Q_0 \mapsto -1, Q_1 \mapsto 1, Q_t \mapsto 1$.
The resulting short exact sequence of $\GG$-modules
\begin{equation}
\label{isacomplex}
0 \rightarrow R \rightarrow  E \stackrel{\alpha^\vee}{\rightarrow} J[\phi] \rightarrow 0
\end{equation}
is split, since it consists of modules that are free as $\Z/r\Z$-modules and have trivial $\GG$-action. Dualizing (\ref{isacomplex}) and taking Galois cohomology, we obtain:
\begin{equation}
\label{embedH1UsingE}
0 \rightarrow H^1(J[\phi^{\dagger}]) \rightarrow H^1(E^{\vee}) \rightarrow H^1(R^\vee) \rightarrow 0.
\end{equation}
By Lemma \ref{rosati}, $H^1(J[\phi^{\dagger}])$ is the same as $H^1(J[\phi])$. We compute that $H^1(E^{\vee}) = H^1(\bmu_r^\Delta) = \prod_{Q \in \Delta} K_d^{\ast}/K_d^{\ast r}$, where the last step is Hilbert 90. Choosing the isomorphism $\Z/r\Z \iso R$ given by $1 \mapsto \rho$, we identify $H^1(R^\vee)$ with $H^1(\bmu_r) = K_d^{\ast}/K_d^{\ast r}$, where the last step is again Hilbert 90. With these identifications, the short exact sequence (\ref{embedH1UsingE}) becomes the bottom row in the diagram. The commutativity of the diagram is Proposition 6.4 in \cite{bps}.

Statement (ii) follows from the exactness of (\ref{embedH1UsingE}).
\end{proof}
%\begin{corollary}
%Let $\f \in K_d(C \times \Delta')$ be some function, and let $D \in \Div^0(C_{K_d}^\f)$ be the principal divisor associated to some function $g \in K_d(C)$. Then $\XminusT^\f(D) = 1$.
%\end{corollary}
%\begin{proof}
%Immediate from the previous proposition and the definition of $\XminusT$.
%\end{proof}
It follows from Proposition \ref{propertiesOfCC} that $\XminusT$ induces a map $J(K_d) \rightarrow \prod_{Q \in \Delta} K_d^{\ast}/K_d^{\ast r}$. We will also denote this map by $\XminusT$. The map $\XminusT$ can be seen as a computation-friendly substitute for the coboundary map $\delta : J(K_d) \rightarrow H^1(J[\phi])$, since we have $\XminusT = \alpha \circ \delta$, where $\alpha$ is an injection.

The rest of this subsection is devoted to the computation of $\XminusT(Q-Q_{\infty})$ for $Q \in \Delta$.

\begin{lemma}
\label{norm}
Let $D \in \Div(C_{K_d}^\circ)$. Then if $\xminusT(D)=(v_0,v_1,v_t)$, we have $v_1v_t/v_0 = v_0^{r-1}v_1v_t = 1$.
\end{lemma}
\begin{proof}
From equation (\ref{equationOfC}) it follows that, if $P \in C_{K_d}^\circ$ is a closed point, then (the norm of) $x(P)^{r-1}(x(P)+1)(x(P)+t)$ is contained in $K_d^{\ast r}$.
\end{proof}

The following lemma states that $\xminusT$ can be ``evaluated on the coordinates on which it makes sense''.

\begin{lemma}
\label{evaluateWhereItMakesSense}
Let $D \in \Div(C_{K_d}^\circ)$ and $D' \in \Div(C_{K_d})$ be linearly equivalent divisors, with $D'$ supported outside of $Q_\infty$. If $Q \in \Delta$ is such that $D'$ is also supported outside of $Q$, then we have
$$
\xminusT(D)_Q = \prod_P (x(P)-x(Q))^{\operatorname{ord}_P(D')}.
$$
\end{lemma}
\begin{proof}
Choose $g \in K_d(C)^{\ast}$ such that $D = D'+\divi(g)$. Observe that $\divi(g)$ is supported outside $Q$ and $Q_\infty$. Then
\begin{align*}
\xminusT(D)_Q & = \prod_P (x(P)-x(Q))^{\operatorname{ord}_P(D)}=\prod_P (x(P)-x(Q))^{\operatorname{ord}_P(D'+\divi(g))} = \\\
 & = \prod_P (x(P)-x(Q))^{\operatorname{ord}_P(D')} \prod_P (x(P)-x(Q))^{\operatorname{ord}_P(g)}.
\end{align*}
In the last expression however, the contribution of the second product is trivial:
$$
\prod_P (x(P)-x(Q))^{\operatorname{ord}_P(g)} = \prod_{P} g(P)^{\operatorname{ord}_P(x-x(Q))} = g(Q)^r g(\infty)^{-r} = 1,
$$
where the first equality is due to Weil reciprocity and the second one rests on the fact that for $Q \in \Delta$ we have $\divi(x-x(Q)) = r \cdot Q - r \cdot Q_\infty$, as is shown by direct calculation.
\end{proof}

For future use, we apply Lemmas \ref{norm} and \ref{evaluateWhereItMakesSense} to the computation of the images under $\XminusT$ of the divisors $Q_1-Q_\infty$ and $P_i - Q_\infty$.

\begin{proposition}
\label{computation}
We have $\XminusT(Q_1-Q_\infty)=(-1,1/(1-t),t-1)$ and $\XminusT(P_{i,j}-Q_\infty) = (\zeta_d^i u,\zeta_d^i u + 1,\zeta_d^i u + t)$.
\end{proposition}
\begin{proof}
For $\bullet \in \{ 0,1,t, \infty \}$, let $D_\bullet \in \Div(C_{K_d}^\circ)$ be a divisor that is linearly equivalent to $Q_\bullet$. Using Lemmas \ref{norm} and \ref{evaluateWhereItMakesSense}, one gets $\xminusT(D_0)=(t,1,t)$, $\xminusT(D_1)=(-1,1/(1-t),t-1)$, and $\xminusT(D_t)= (-t,1-t,t/(t-1))$. Applying (\ref{divy}), we then find $\xminusT(D_\infty) = (1,1,1)$. Hence $\XminusT(Q_1-Q_\infty)=\xminusT(D_1-D_\infty)=(-1,1/(1-t),t-1)$.

Finally, we have $\XminusT(P_{i,j} - Q_\infty) = \XminusT(P_{i,j} - D_\infty) = \xminusT(P_{i,j}) - \xminusT(D_\infty) = (\zeta_d^i u,\zeta_d^i u + 1,\zeta_d^i u + t)$.
\end{proof}

\subsection{The image of $\XminusT$}

Let $N \subset J(K_d)$ be the subgroup generated by the divisor classes $[P_{i,j} - Q_\infty]$, where $i \in \{0,\ldots,d-1\}$ and $j \in \{0,\ldots,r-1\}$. Observe that the known torsion elements $[Q_0 - Q_\infty]$, $[Q_1 - Q_\infty]$, $[Q_t - Q_1]$ and $[D] = [\sum_{i=0}^{d-1} \sum_{j=0}^{[-1-i]} P_{i,j}]$ (the $D$ is as in Lemma \ref{newtorsion}) are all contained in $N$ by Lemmas \ref{tworels} and \ref{newtorsion}. Therefore $N$ contains all elements of $J(K_d)$ described so far. 

\begin{proposition}
\label{dimensiond}
We have $\dim_{\F_r} \XminusT(N) = d$.
\end{proposition}
\begin{proof}
Since $\XminusT(P_{i,j}-Q_\infty) = \XminusT(\zeta_r^j (P_{i,0}-Q_\infty)) = \XminusT(P_{i,0} - Q_\infty)$, the dimension certainly cannot be larger than $d$. To show that it is precisely $d$, we project down from $\prod_{Q \in \Delta} K_d^{\ast} / K_d^{\ast r}$ to a finite-dimensional quotient space of dimension $d$, and conclude by showing that the projection is surjective.

We define the following map:
\begin{align*}
\pr : \prod_{Q \in \Delta} K_d^{\ast} / K_d^{\ast r} & \rightarrow \F_r^{d} \\\
(v_0,v_1,v_t)                                    & \mapsto (\val_{u+1}(v_1),\val_{u+\zeta_d^{-1}}(v_1),\val_{u+\zeta_d^{-2}}(v_1),\ldots,\val_{u+\zeta_d}(v_1))
\end{align*}

By Proposition \ref{computation}, we have $\XminusT(P_{i,j}-Q_\infty) = (\zeta_d^i u,\zeta_d^i u + 1,\zeta_d^i u + t)$. We see that $\pr$ maps the image of $P_{i,j} - Q_\infty$ to the $i$-th basis vector. Hence $\pr$ maps $\XminusT(N)$ surjectively onto $\F_r^d$. This establishes the proposition.
\end{proof}

\begin{lemma}
\label{dimensiontorsion}
The image under $\XminusT$ of the subgroup generated by $[D]$ and $[Q_1-Q_\infty]$ has $\F_r$-dimension $2$.
\end{lemma}
\begin{proof}
Since $\XminusT(P_{i,j}-Q_\infty) = \XminusT(P_{i,0} - Q_\infty)$, as noted in the proof of Proposition \ref{dimensiond}, we see that the image of $D=\sum_{i=0}^{d-1} \sum_{j=0}^{[-1-i]} P_{i,j}$ is the same as that of $\sum_{i=0}^{d-1} (d-i) (P_{i,0} - Q_\infty)$. If we resume the notation of the proof of Proposition \ref{dimensiond}, we find $\pr(\XminusT(D)) = (0,-1,-2,\ldots,-d+1) \in \F_r^d$.

Proposition \ref{computation} gives $\XminusT(Q_1-Q_\infty)=(-1,1/(1-t),t-1)$. Since in $K_d$ we have the factorization $1-t = \prod_{i=0}^{d-1} (1-\zeta_d^i u)$, we get $\pr(\XminusT(Q_1-Q_\infty)) = (-1,-1,-1,\ldots,-1)$. The lemma now follows.
\end{proof}

\subsection{Some algebra. The proof of Theorem \ref{subgoal}}

Since $J(K_d)/\phi J(K_d) = J(K_d) \otimes_{\Z[\zeta_r]} \F_r$, we have a commutative diagram
\[
\xymatrix{
J(K_d) \ar@/_/[dr]^{\XminusT} \ar[r] &  J(K_d) \otimes_{\Z[\zeta_r]} \F_r \ar@{^(->}[d] \\\
& \prod_{Q \in \Delta} K_d^{\ast}/K_d^{\ast r}
}
\]
Let $N$ be a $\Z[\zeta_r]$-submodule of $J(K_d)$. Then the image of $N$ under $\XminusT$ can be identified with the image of the map $N \rightarrow J(K_d) \otimes_{\Z[\zeta_r]} \F_r$. Part (ii) of the following result compares the $\F_r$-dimension of this image with the rank of $N$. Part (i) is particularly useful in pinning down the torsion subgroup $J(K_d)[r^{\infty}]$ of $J(K_d)$.

\begin{proposition}
\label{theAlgebraPart}
Let $R = \Z[\zeta_r]$ and $\phi = 1-\zeta_r$. Let $M$ and $N$ be $R$-modules with $N \subset M$.  
\begin{itemize}\itemsep=0pt
\item[(i)] We have: $M[r^\infty] = M[\phi^\infty] \cong \bigoplus_{i=1}^t R/(\phi^{e_i})$ as $R$-modules, with $t = \dim_{\F_r} M[\phi]$.
\end{itemize}
Let $\rho = \dim_{\Q(\zeta_r)} N \otimes_{\Z} \Q$ be the rank of $N$ as $R$-module, and let $V \subset M \otimes_R \F_r$ be the image of the map $N \rightarrow M \otimes_R \F_r$.
\begin{itemize}\itemsep=0pt
\item[(ii)] We have:
$$
\rho = \dim_{\F_r} V + \dim_{\F_r} (M/N)[\phi] - \dim_{\F_r} M[\phi].
$$
\end{itemize}
%Let $N_0 \subset M[\phi^\infty]$ be an $R$-submodule. Let $V_0 \subset M \otimes_R \F_r$ be the image of the map $N_0 \rightarrow M \otimes_R \F_r$.
%\begin{itemize}\itemsep=0pt
%\item[(iii)] We have: $N_0 = M[\phi^\infty]$ if and only if $\dim_{\F_r} V_0 = \dim_{\F_r} M[\phi]$.
%\end{itemize}
\end{proposition}
\begin{proof}
Since the elements $r$ and $\phi^{r-1}$ of $\Z[\zeta_r]$ generate the same ideal, they differ by a unit, and hence we have $M[r^\infty] = M[\phi^\infty]$. Localizing at the prime ideal $(\phi)$, we find, by the structure theorem for finitely generated modules over principal ideal domains:
$$
M_{(\phi)} \cong R_{(\phi)}^s \oplus \bigoplus_{i=1}^{t} R/(\phi^{e_i}),
$$
for some choice of non-negative integers $s,t$ and $e_i$. Since localizing at $(\phi)$ does not affect $\phi$-power torsion, we find $M[\phi^\infty] \cong \bigoplus_{i=1}^{t} R/(\phi^{e_i})$. From the isomorphism, it is clear that $t = \dim_{\F_r} M[\phi]$. This proves part (i).

For part (ii) of the statement, observe that we have a six-term exact sequence
\begin{equation}
\label{sixterm}
0 \rightarrow N[\phi] \rightarrow M[\phi] \rightarrow (M/N)[\phi] \rightarrow N\otimes_R \F_r \rightarrow M\otimes_R \F_r \rightarrow (M/N) \otimes_R \F_r \rightarrow 0,
\end{equation}
where the middle map sends $m + N$ to $\phi m \otimes 1$. (It is the long exact sequence that results from applying $- \otimes_R \F_r$ to $0 \rightarrow N \rightarrow M \rightarrow M/N \rightarrow 0$, but it is easy to verify the exactness without using this.) Truncating (\ref{sixterm}) at the fifth term, we get the exact sequence
 \begin{equation}
\label{fiveterm}
0 \rightarrow N[\phi] \rightarrow M[\phi] \rightarrow (M/N)[\phi] \rightarrow N\otimes_R \F_r \rightarrow V \rightarrow 0.
\end{equation}
Using
$$
\dim_{\F_r} N \otimes_R \F_r = \dim_{\F_r} N_{(\phi)} \otimes_{R_{(\phi)}} \F_r = \rho + \dim_{\F_r} N[\phi],
$$
and the fact that the $\F_r$-dimensions of the terms of (\ref{fiveterm}) add up to zero, part (ii) follows.
%Now part (iii). Applying (\ref{sixterm}) with $N$ replaced by $M[\phi^\infty]$ shows that
%$$
%M[\phi^\infty] \otimes_R \F_r \rightarrow M \otimes_R \F_r
%$$
%is injective. Hence $\dim_{\F_r} V_0$ equals the $\F_r$-dimension of the image of $N_0$ in $M[\phi^\infty] \otimes_R \F_r$. %Consider 
%$$
%0 \rightarrow N_0 \rightarrow M[\phi^\infty] \rightarrow M[\phi^\infty]/N_0 \rightarrow 0.
%$$
%By right-exactness of tensor products, the map $N_0 \rightarrow M[\phi^\infty]$ is surjective if and only if $N_0  \rightarrow M[\phi^\infty] \otimes_R \F_r$ is, and the latter condition is equivalent to the dimension of the image being $\dim_{\F_r} M[\phi^\infty] \otimes_R \F_r$, which by part (i) equals $\dim_{\F_r} M[\phi]$.
\end{proof}

We are now ready to give the proof of Theorem \ref{subgoal}. 

\begin{proof}
First, we determine $J(K_d)[r^\infty]$. By Propositions \ref{propertiesOfPhi} and \ref{theAlgebraPart}.(i) we find that
$$
J(K_d)[r^\infty] \cong \Z[\zeta_r]/(1-\zeta_r)^{e_1} \oplus \Z[\zeta_r]/(1-\zeta_r)^{e_2}
$$
for some positive integers $e_1,e_2$. Since the image under $\XminusT$ of the subgroup $T \subset J(K_d)[r^\infty]$ generated by $[D]$ and $[Q_1 - Q_\infty]$ has $\F_r$-dimension 2, we must have $T = J(K_d)[r^\infty]$ by Nakayama's Lemma.

Let $N \subset J(K_d)$ be the subgroup generated by the divisor classes $[P_{i,j} - Q_\infty]$, where $i \in \{0,\ldots,d-1\}$ and $j \in \{0,\ldots,r-1\}$. From Proposition \ref{dimensiond} and Proposition \ref{theAlgebraPart}.(ii) we find:
$$
\rk_{\Z[\zeta_r]}(N) = d-2+\dim_{\F_r} (J(K_d)/N)[1-\zeta_r].
$$
It follows from our computations that $N \otimes_{\Z[\zeta_r]} \F_p$ injects into $J(K_d) \otimes_{\Z[\zeta_r]} \F_p$, which implies that $\dim_{\F_r} (J(K_d)/N)[1-\zeta_r]=0$ by (\ref{sixterm}). Therefore, the $\Z$-rank of $N$ is equal to $(r-1)(d-2)$.
\end{proof}



\section{Proof of Theorem \ref{smallerfldthm}}
%\begin{proof}
Recall that $o_q(e)$ denotes the order of $q$ in $(\Z/e\Z)^\times$.

%We know how $\Gal(K_d/\F_q(t^{1/d}))$ acts on the $P_{i,j}$'s
%and we know all the relations among the $P_{i,j}$'s
%(from our rank calculations), so we can compute
%$$
%\langle D_{i,j} \rangle^{\Gal(K_d/\F_q(t^{1/d}))}.
%$$

%More precisely, n
We showed above that $J(K_d) \otimes \Q = \langle D_{\zeta,\rho} \rangle \otimes \Q$.
Let
$V$ denote the free $\Q(\bmu_r)$-vector space with basis
$\{ R_\zeta : \zeta \in \bmu_d \}$, where $R_\zeta$ is a formal symbol.
Then $\dim_{\Q(\bmu_r)} V = d$ and $\dim_{\Q} V = d(r-1)$.
Let $W$ be the subspace of $V$ generated by 
$\sum_{\zeta \in \bmu_d}R_\zeta$ and 
$\sum_{\zeta \in \bmu_d}\zeta^{-d/r}R_\zeta$.
Then $\dim_{\Q(\bmu_r)} W = 2$.
Thus, $\dim_{\Q(\bmu_r)} V/W = d-2$ and $\dim_{\Q} V/W = (d-2)(r-1)$.
Note that $W$ is in the kernel of 
the surjective map $F : V \onto \langle D_{\zeta,\rho} \rangle \otimes \Q$
defined by $R_\zeta \mapsto D_{\zeta,1}$.
It follows that
$$
(d-2)(r-1) = \dim_{\Q} V/W  \le \rk_\Z \langle D_{\zeta,\rho} \rangle \le \rk_\Z J(K_d).
$$
By Proposition \ref{subgoal} we have 
$$
\dim_{\Q} V/W = (d-2)(r-1) \le \dim(\langle D_{\zeta,\rho} \rangle \otimes \Q).
$$
Thus, $W=\ker(F)$, and
$$
V/W \cong \langle D_{\zeta,\rho} \rangle \otimes \Q = J(K_d) \otimes \Q.
$$

Let $u=t^{1/d}$ and $H = \Gal(K_d/\F_q(\bmu_r,u))$.
Then
$$
J(\F_q(\bmu_r,u)) \otimes \Q =  (J(K_d) \otimes \Q)^H \cong (V/W)^H.
$$
Since $\F_q(\bmu_r) = \F_{q^t}$, we have $\F_q(\bmu_r,u) = \F_{q^t}(u)$
and $[\F_q(\bmu_r,u): \F_{q}(u)]=t$.
In particular, $H$ can be identified with the subgroup of $(\Z/d\Z)^\times$
generated by $q^t$.

We have
$$
\dim_{\Q(\bmu_r)} (V/W)^H = \dim_{\Q(\bmu_r)} V^H - \dim_{\Q(\bmu_r)} W^H.
$$
Clearly, $W^H = W$.
Further, $\dim_{\Q(\bmu_r)} V^H$ is the number of orbits of
$\{ R_\zeta \}$ under the action of $H$.
For each $e\mid d$, there are $\frac{\varphi(e)}{o_{q^t}(e)}$
orbits consisting of $R_\zeta$'s with $\zeta$ a primitive $e$-th
root of unity, since there are $o_{q^t}(e)$ of them in each orbit.
Thus, 
$\dim_{\Q(\bmu_r)} V^H = \sum_{e\mid d}\frac{\varphi(e)}{o_{q^t}(e)}$,
so
$$
\rank_\Z J(\F_q(\bmu_r,u)) = \dim_{\Q} (V/W)^H
= (r-1)\dim_{\Q(\bmu_r)} (V/W)^H
= (r-1)\left[\sum_{e\mid d}\frac{\varphi(e)}{o_{q^t}(e)}- 2 \right].
$$
Lemma 13.4 of \cite{ps} says that if $k$ is a global field of characteristic
not $r$, $f(x)$ is an $r$-th power-free polynomial with zeros in $k^{\sep}$,
and $J$ is the Jacobian of $y^r=f(x)$, then
$\rank_\Z J(k) = \rank_\Z J(k(\bmu_r))/[k(\bmu_r): k]$.
Thus,
\begin{equation}
\label{jfuz}
\rank_\Z J(\F_q(u)) = {\frac{r-1}{t}}\left[\sum_{e\mid d}\frac{\varphi(e)}{o_{q^t}(e)}-
2 \right].
\end{equation}


Fixing $q$, $r$, and $d$ with $d=p^f+1$, for all $s\in\Z^+$
let $d_s = p^{fs}+1$, so $r\mid d\mid d_s$.
Apply \eqref{jfuz} to 
the Jacobians of the curves $y^r=x^{r-1}(x+1)(x+u^{d_s})$ to obtain
unbounded rank over $\F_q(u)$ as $s$ grows.
%\end{proof}

\begin{rem}
Note that if $q$ is odd, then 
$$\rank_\Z J(\F_q(\bmu_r,t^{1/d})) = (r-1)\left[\sum_{2<e\mid d}\frac{\varphi(e)}{o_{q^t}(e)} \right]
$$
and
$$
\rank_\Z J(\F_q(t^{1/d})) = {\frac{r-1}{t}}\left[\sum_{2<e\mid d}\frac{\varphi(e)}{o_{q^t}(e)} \right],
$$
summing over the divisors $e$ of $d$ with $e>2$.
In the case of Legendre curves, we have $r=2$ so $t=1$, recovering 
Theorem 12.1(3) from \cite{Legendre}.
\end{rem}


\begin{rem}
Note also that if $r$ were composite, and if we knew that
the rank of $\langle P_{\zeta,\rho} \rangle \otimes \Q$ were 
$\ge (d-2)\varphi(r)$,
then we could replace $r-1$ by $\varphi(r)$ in Theorem \ref{smallerfldthm}.
\end{rem}




%\section{Torsion}


\section{$r$-torsion}
%Doug
[Mostly superseded by an earlier section. Some of the info here can be put in 
the earlier section.]

We work with the curve
$$y^r=x^{r-1}(x+1)(x+t)$$
where $r$ is prime.  Over $K_d$ with $d=q+1$ divisible by $r$, we have points
$$Q_0=(0,0),\quad Q_1=(-1,0),\quad Q_t=(-t,0),$$
the point at infinity $Q_\infty$, and
$$P_{i,j}=\left(\zeta^iu,\zeta^{jd/r+i}u(\zeta^iu+1)^{d/r}\right).$$
Here $u^d=t$, $\zeta$ is a fixed primitive $d$-th root of unity in
$K_d$ and we read $i$ modulo $d$ and $j$ modulo $r$.

We consider the functions $f=y-x(x+1)^{d/r}$,
$g=yx^{d/r-1}-u^{d/r}(x+1)^{d/r}$, and $x$.  Calculating as in
Prop.~3.2 of \cite{Legendre}, 
%(There is a typo there: In the second
%equality of the statement of 3.2, $Q_0$ should be $Q_1$.  In Remark
%3.3, $2\sum...$ should be $Q_0$ not $Q_1$), 
we find that
$$div(f)=\sum_iP_{i,0}+(r-1)Q_0+Q_1-(r+d)Q_\infty$$
$$div(g)=\sum_iP_{i,-i}+Q_1-(d+1)Q_\infty$$
and
$$div(x)=r\left(Q_0-Q_\infty\right).$$
It follows that 
$$div(f/(xg))=\sum_i\left(P_{i,0}-P_{i,-i}\right)-Q_0+Q_\infty.$$

Now I claim that $\sum_i\left(P_{i,0}-P_{i,-i}\right)$ is
$(1-\zeta^{d/r})D$ for a suitable $D$.  To see this, we group the sum
into pieces where $i$ lies in a given class modulo $r$:
$$\sum_{i\equiv -j\pmod r}\left(P_{i,0}-P_{i,-i}\right)
=\sum_{i\equiv -j\pmod r}\left(P_{i,0}-P_{i,j}\right)$$
and then we observe that 
$$(1-\zeta^{d/r})\left(P_{i,0}+P_{i,1}+\cdots+P_{i,j-1}\right)
=P_{i,0}-P_{i,j}.$$

This proves that $Q_0-Q_\infty$ is equivalent to $(1-\zeta^{d/r})D$
for a suitable $D$.

For future use, it might be worth introducing functions
$$f_j=\zeta^{-jd/r}y-x(x+1)^{d/r}$$
and 
$$g_j=\zeta^{-jd/r}yx^{d/r-1}-u^{d/r}(x+1)^{d/r}$$
whose divisors are
$$div(f_j)=\sum_iP_{i,j}+(r-1)Q_0+Q_1-(r+d)Q_\infty$$
and
$$div(g_j)=\sum_iP_{i,-i+j}+Q_1-(d+1)Q_\infty.$$


\section{$\ell$-torsion for $\ell \nmid 2pr$}
%Chris

Notation: $r$ is prime, $\ell$ is a prime not dividing $2pr$, $\lambda$ is a prime of $\Q(\zeta_r)$ above $\ell$, $K={\bar \F_q}(t)$, $K_\lambda = K(J[\lambda])$, and $G=\Gal(K_\lambda/K)$. 

The heart of the proof is showing that $G$ has a subgroup $H$ that is perfect (i.e., $H=[H,H]$) and satisfies $J[\lambda]^H = 0$. (From that, one can easily show that if $L/K$ is abelian then $J(L)[\lambda]=0$.)

Construct $H$ as follows. Using that $K_\lambda/K$ is unramified away from $t=0,1,\infty$ and tamely ramified otherwise, one can show that $G$ is generated by three elements $g_0,g_1,g_\infty$ satisfying $g_0g_1g_\infty=1$ and corresponding to generators of inertia for primes over $t=0,1,\infty$ respectively. Let $H$ be the subgroup of $G$ generated by the conjugates of $g_0$.

To show that $H$ has the desired properties, one uses the injection from $G$ into 
$\GL_2(F_\lambda)$, where $F_\lambda=\Z[\zeta_r]/\lambda$, and views $G$ and $H$ in $\GL_2(F_\lambda)$. Combining $g_0g_1g_\infty=1$ with information about the Jordan forms of $g_0,g_1,g_\infty$ that one can compute using the geometry of the Neron model, one can show that H is an irreducible subgroup of $\GL_2(F_\lambda)$ generated by transvections. The classification of such groups can be used to show that H has the desired properties (perfect and $J[\lambda]^H = 0$).







\section{The curve is generically ordinary}
%Rachel

Let $C$ be the smooth projective curve of genus $g=r-1$ with affine model
\[y^r=x^{r-1}(x+1)(x+t).\]
The purpose of this note is to show that $C$ is ordinary.

To state this more precisely, we view $C$ as a curve over $\FF_q(t)$.  It is a Galois cover of the projective $x$-line over $\FF_q(t)$ with Galois group $\ZZ/r$.
We choose a generator $\delta:(x,y) \mapsto (x, \zeta^{-1} y)$ for the Galois group where $\zeta$ is an $r$th root of unity.
Let $J$ be the Jacobian of $C$.

We say that $C$ and $J$ are {\it ordinary} if the number of $p$-torsion points on $J$ is as large as possible, 
namely $\#J[p](\overline{\FF_q(t)})=p^g$. 
One can also look at this condition as $t$ varies.
Given a geometric point $t$ of the projective line over $t$, let $C_t$ be the fiber of ${\mathcal C}$ above $t$.
Let $J_t$ denote the Jacobian of $C_t$.  
We say that $C_t$ and $J_t$ are {\it ordinary} if the number of $p$-torsion points on $J_t$ is as large as possible, 
namely $\#J_t[p](\overline{\FF}_p)=p^g$. 

We will prove that $C$ is ordinary using an equivalent condition:
$C$ is ordinary iff the Cartier operator $\car$ has rank $g$ on the vector space $H^0(C, \Omega^1_C)$ of regular $1$-forms on $C$.
Some of the properties of the Cartier operator that we will need are:
\[\car(\omega_1 + \omega_2)=\car(\omega_1) + \car(\omega_2);\]
\[\car(\frac{f^p dx}{x})=\frac{f dx}{x};\]
\[\car(\frac{x^i dx}{x})=0 \ {\rm if \ p \nmid i}.\] 

\begin{proposition}
The curve $C$ is ordinary.  Alternatively, 
there is a non-empty Zariski open subset of $\PP_t$ such that $C_t$ is ordinary.
\end{proposition}

\begin{proof}
Let $D_i$ denote the subspace of $H^0(C, \Omega^1_C)$ on which $\delta^*$ acts by multiplication by $\zeta^i$.
There is an eigenspace decomposition
\[H^0(C, \Omega^1_C) \simeq \oplus_{i=0}^{r-1} D_i.\]

One can show that $\omega_i:=x^{i-1}\frac{dx}{y^i}$ is a regular $1$-form and $\delta^*(\omega_i)=\zeta^i \omega_i$ for $1 \leq i \leq r-1$.
In particular, this implies that $D_0=0$ and $D_i = \langle \omega_i \rangle$ has dimension $1$ for $1 \leq i \leq r-1$.
Thus $\Omega=\{\omega_i \mid 1 \leq i \leq r-1\}$ is a basis for $H^0(C, \Omega^1_C)$.
With respect to the basis $\Omega$, we will show that the Cartier operator acts as a permutation matrix scaled by constants which are non-zero 
as long as $t$ does not satisfy certain algebraic equations.

Given $r$, $p$, and $i$ such that $1 \leq i \leq r-1$: 
let $a$ be the unique integer such that $1 \leq a \leq r-1$ and $ap \equiv i \bmod r$;
let $b$ be the unique integer such that $1 \leq b \leq p-1$ and $br \equiv -i \bmod p$.
Using the Chinese remainder theorem, we see that $ap-br=i$.

Then 
\[\car(\omega_i)=\car(x^i \frac{y^{br}}{y^{ap}}\frac{dx}{x})=\frac{1}{y^a}\car(h(x) \frac{dx}{x}),\]
where $h(x)=x^{i+(r-1)b}(x+1)^b(x+t)^b$.
The exponent of each monomial in $h(x)$ is in the range $[i+(r-1)b, i+(r+1)b]=[ap-b, ap+b]$; the only multiple of $p$ in this range is $ap$.
Let $c_i$ be the coefficient of $x^{ap}$ in $h(x)$.
Then $c_i$ is the coefficient of $x^b$ in $(x+1)^b(x+t)^b$.
In other words:
\[c_i=\sum_{j=0}^b {b \choose j}^2 t^j  = 1 + b^2 t + \cdots + b^2t^{b-1} + t^b.\]
It follows that: 
\[\car(\omega_i)=c_i^{1/p} \frac{x^a}{y^a} \frac{dx}{x}= c_i^{1/p} \omega_a.\]
In conclusion, as long as $t$ is not a root of any of the polynomials $c_i(t)$ as $i$ (or $b$) ranges from $1$ to $r-1$, then $\car$ has rank $g$ on $H^0(C, \Omega^1_C)$
and so $C_t$ is ordinary.
\end{proof}






\section{Kodaira-Spencer and $p$-torsion}
%Doug

[Comments in square brackets are editorial and not meant for any
public version.]

In this section, we calculate the Kodaira-Spencer map for the curve
$X/k(t)$ given by $y^r=(x+1)(x+t)/x$ and use it to bound the
$p$-torsion of the Jacobian of $X$.

\subsection{An integral model}\label{s:model}
Throughout $k$ will be field of characteristic $p\ge0$ and $R$ will be
the ring $k[t][1/t,1/(t-1)]$ with field of fractions $K=k(t)$. It is
convenient, although not essential, that $R$ is a PID.  
Let $U=\spec R$, an affine open subset of $\P^1_k$.

Let $r$ be a prime not divisible by $p$ and let $X$ be the smooth
proper curve over $K$ associated to the plane curve
$y^r=x^{r-1}(x+1)(x+t)$. In this section we will write down explicitly
a smooth projective model of $X$ over $U$, i.e., a surface $\XX$
equipped with a smooth projective morphism $\pi:\XX\to U$ with generic
fiber $X$.

Let $\YY$ be the closed subset of $\P^2_R$ defined by
$$Y^rZ=X^{r-1}(X+Z)(X+tZ).$$
A calculation using the Jacobian criterion shows that $\YY\to U$ is
smooth away from the divisor $X=Y=0$. Resolving the singularity at
$X=Y=0$ in each fiber will lead to $\XX\to U$.

Let $\XX_1$ be the affine scheme
$$\spec R[x,y]/\left(y-x^{r-1}(xy+1)(xy+t)\right).$$
By the Jacobian criterion, $\XX_1\to U$ is smooth. The map
$\XX_1\to\YY$ given by $X=xy$, $Y=y$, $Z=1$ is a morphism whose image
is the open subset of $\YY$ where $Z\neq0$ minus the points with
$[X,Y,Z]=[-1,0,1]$ and $[-t,0,1]$. It is an isomorphism away from
$x=y=0$. 
%[$\XX_1$ is the blow up of the open $Z\neq0$ along $X=Y=0$.]

Let $\XX_2$ be the affine scheme
$$\spec R[w,z]/\left(z-w^{r-1}(w+z)(w+tz)\right).$$
By the Jacobian criterion, $\XX_2\to U$ is smooth.  The map
$\XX_2\to\YY$ given by $X=w$, $Y=1$, $Z=z$ is a morphism which maps
$\XX_2$ isomorphically into the open subset $Y\neq0$ of $\YY$.

Let $\XX_3$ be the affine scheme
$$\spec R[u,v]/\left(u^rv-(1+v)(1+tv)\right).$$
By the Jacobian criterion, $\XX_3\to U$ is smooth.  The map
$\XX_3\to\YY$ given by $X=1$, $Y=u$, $Z=v$ is a morphism which maps
$\XX_3$ isomorphically into the open subset $X\neq0$ of $\YY$.

Now we glue $\XX_1$, $\XX_2$ and $\XX_3$ over $U$ via the identifications
$$(x,y)=(w,1/z)\qquad(w,z)=(1/u,v/u)\qquad(u,v)=(1/x,1/(xy))$$
[A more careful exposition would include the domains and ranges.]
and call the result $\XX$, with its projection $\pi:\XX\to U$ to the base
$U$.   Since each of the $\XX_i$ are smooth over $U$, so is $\XX$.
Note also that we have a factorization $\XX\to\YY\to U$ and
$\XX\to\YY$ is a homeomorphism, so $\XX\to U$ is projective.

If the $r$-th roots of unity lie in $k$, then there is an
action of $\bmu_r$ on $\XX$ which is given in coordinates by
$$(x,y)\mapsto(\zeta^{-1} x,\zeta y)\qquad
(w,z)\mapsto(\zeta^{-1}w,\zeta^{-1}z)\qquad
(u,v)\mapsto(\zeta u,v).$$

\subsection{Differentials}
Consider meromorphic 1-forms (sections of $\Omega^1_{\XX/U}$) defined
on $\XX_1$, $\XX_2$, and $\XX_3$ by the formulas
$$\frac{x^{i-1}d(xy)}{y},\qquad
w^{i-1}dw-\frac{w^idz}{z},\quad\text{and}\quad-\frac{dv}{u^iv}$$ 
for $1\le i\le r-1$. It is a simple exercise to check that these
1-forms agree on the overlaps and that the are everywhere regular and
therefore define global 1-forms (global sections of
$\Omega^1_{\XX/U}$) which we denote $\omega_i$. Considering the action
of $\bmu_r$ (or the order of vanishing at points where $x=y=0$) shows
that the restrictions of the $\omega_i$ to any fiber of $\XX\to U$ are
linearly independent. Since the genus of $X$ is $r-1$, we see that the
$\omega_i$ generate $\Omega^1_{\XX/U}$ at every point of $U$.
Equivalently, 
$$H^0(U,\pi_*\Omega^1_{\XX/U})=
H^0(\XX,\Omega^1_{\XX/U})=\bigoplus_{i=1}^{r-1}R\omega_i$$ 
where the latter is the free $R$-module with basis $\{\omega_i\}$.

\subsection{Kodaira-Spencer}\label{s:KS}
Consider the exact sequence of sheaves on $\XX$:
$$0\to\pi^*\Omega^1_U\to\Omega^1_{\XX}\to\Omega^1_{\XX/U}\to 0.$$
Taking the direct image under $\pi$ leads to a morphism
$$KS:\pi_*\Omega^1_{\XX/U}\to R^1\pi_*\O_\XX\tensor_{\OO_U}\Omega^1_{U}$$
which is the ``Kodaira-Spencer map'' of the family $\pi:\XX\to U$.

The main technical point of this fragment is the following.

\begin{prop}\label{prop:KS}
The map $KS$ is an
isomorphism of locally free $\OO_U$-modules of rank $r-1$ on $U$.
\end{prop}

It will be more convenient for us to consider the ``Kodaira-Spencer
pairing'' on global 1-forms 
\begin{align*}
H^0(U,\pi_*\Omega^1_{\XX/U})&\times H^0(U,\pi_*\Omega^1_{\XX/U})&&\to&
H^0(U,\Omega^1_U)=R\,dt\\
\omega_i&\times\omega_j&&\mapsto&(\omega_i,\omega_j)\qquad
\end{align*}
defined by taking the cup product
$$KS(\omega_i)\cup\omega_j
\in R^1\pi_*\Omega^1_{\XX/U}\tensor_{\OO_U}\Omega^1_U$$
followed by the trace
$$ R^1\pi_*\Omega^1_{\XX/U}\tensor_{\OO_U}\Omega^1_U\quad\isoto\quad \Omega^1_U.$$
To show that $KS$ is an isomorphism is the same as to show that the
Kodaira-Spencer pairing is a perfect pairing of free $R$-modules. A
proof that the pairing is perfect will be given in the next two
sections.

\subsection{Lifting 1-forms}
We will compute the Kodaira-Spencer pairing using Cech cohomology for the affine open
cover $\{\XX_1,\XX_2,\XX_3\}$ of $\XX$. The key point is to find for
each $\alpha=1,2,3$ a lift of $\omega_i$ to a section of
$\Omega^1_{\XX}(\XX_\alpha)$. Taking the differences on the overlaps
gives a 1-cocycle representing a class in
$R^1\pi_*\OO_\XX\tensor\Omega^1_U$. We will then compute the cup
product with $\omega_j$ and the trace to get an element of $R\,dt$.

[The calculations below also justify the regularity assertions made
about the $\omega_i$ above.]

First consider $\XX_1$, where we have the equality
\begin{equation}\label{eq:X1}
0=y-x^{r-1}(xy+1)(xy+t)
\end{equation}
the differential of which leads to the relation
\begin{multline}\label{eq:dX1}
0=dy\left(1-x^r(xy+t)-x^{r-1}(xy+1)\right)\\
+dx\left(-(r-1)x^{r-2}(xy+1)(xy+t)-x^{r-1}(xy+t)y-x^{r-1}(xy+1)y\right)\\
+dt\left(-x^{r-1}(xy+1)\right).
\end{multline}
Now consider the naive lift of $\omega_i$ to $\Omega^1_{\XX}$ on $\XX_1$:
$$\frac{x^{i-1}d(xy)}{y}=\frac{x^idy}{y}+x^{i-1}dx.$$
This is obviously regular away from $y=0$. Near $y=0$, the equality
\eqref{eq:X1} shows that in an open neighborhood of $y=0$, the
function $y$ is a unit times $x^{r-1}$. Also, near $y=0$ the
coefficient of $dy$ in \eqref{eq:dX1} is a unit and the coefficients of $dx$
and $dt$ are divisible by $x^{r-2}$, so we may rewrite $x^idy$ (with
$i\ge1$) as a regular 1-form times $x^{r-1}$. Therefore $x^{i}dy/y$ is
everywhere regular on $\XX_1$. This shows that
$\frac{x^{i-1}d(xy)}{y}$ is a section of $\Omega^1_{\XX}$ which maps
to $\omega_i$ in $\Omega^1_{\XX/U}$.

Next we turn to $\XX_2$, where we have the equality 
\begin{equation}\label{eq:X2}
0=z-w^{r-1}(w+z)(w+zt)
\end{equation}
the differential of which leads to the relation
\begin{multline}\label{eq:dX2}
0=dz\left(1-w^{r-1}(w+zt)-w^{r-1}(w+z)t\right)\\
+dw\left(-(r-1)w^{r-2}(w+z)(w+zt)-w^{r-1}(w+zt)-w^{r-1}(w+z)\right)\\
+dt\left(-w^{r-1}(w+z)z\right).
\end{multline}
Now consider the naive lift of $\omega_i$ to $\Omega^1_{\XX}$ on
$\XX_2$:
$$\frac{w^{i-1}d(w/z)}{1/z}=\frac{w^idz}{z}+w^{i-1}dw.$$
This is obviously regular away from $z=0$. Near $z=0$, the equality
\eqref{eq:X2} shows that $z$ is a unit times $w^{r+1}$. Also, near
$z=0$ the coefficient of $dz$ in \eqref{eq:dX2} is a unit and the
coefficients of $dw$ and $dt$ are divisible by $w^{r}$, so we may
rewrite $w^idz$ (with $i\ge1$) as a regular 1-form times $w^{r+1}$.
This shows that $w^idz/z$ is everywhere regular on $\XX_1$ and
therefore $\frac{w^{i-1}d(w/z)}{1/z}$ is a section of $\Omega^1_{\XX}$
which maps to $\omega_i$ in $\Omega^1_{\XX/U}$.

Finally, we turn to $\XX_3$, where we will have to work harder.  We
have the equality
\begin{equation}\label{eq:X3}
0=u^rv-(1+v)(1+tv)
\end{equation}
the differential of which leads to the relation
\begin{equation}\label{eq:dX3}
0=du\left(ru^{r-1}v\right)
+dv\left(u^r-(1+tv)-(1+v)t\right)
+dt\left(-(1+v)v\right).
\end{equation}
The naive lift of $\omega_i$ turns out not to be regular on all of
$\XX_3$.  Instead of it, we consider
$$\frac{-dv}{u^iv}-\frac{1+v}{u^i}\frac{dt}{t-1}.$$
The equations \eqref{eq:X3} and \eqref{eq:dX3} and some algebra lead
(eventually ...) to the equality
$$\frac{-dv}{u^iv}+\frac{1+v}{u^i}\frac{dt}{t-1}=
\frac{ru^{r-1-i}du}{u^r-(1+tv)-(1+v)t}+\frac{u^{r-i}(v-1)}{u^r-(1+tv)-(1+v)t}\frac{dt}{t-1}$$
Now we note that $t-1$ and $v$ are units on all of $\XX_3$ and that 
$u^r-(1+tv)-(1+v)t$ is a unit in a neighborhood of the locus where
$u=0$.  Thus the left hand side is regular where $u\neq0$ and the
right hand side is regular in a neighborhood of $u=0$.  Together they
define a section of $\Omega^1_{\XX/U}$ on $\XX_3$ which lifts
$\omega_i$.

\subsection{Computing the Kodaira-Spencer pairing}
Taking differences of lifts on overlaps yields the following 1-cocycle
with values in $\pi^*\Omega^1_U$:
$$g_{12}=g_{21}=0\qquad g_{23}=-g_{32}=g_{13}=-g_{31}=
\frac{1+v}{u^i}\frac{dt}{t-1}.$$
Here $g_{\alpha\beta}$ is a section of $\pi^*\Omega^1_U$ over
$\XX_{\alpha\beta}=\XX_{\alpha}\cap\XX_{\beta}$ for
$\alpha,\beta\in\{1,2,3\}$.

Taking the cup product of $KS(\omega_i)$ with $\omega_j$, we get a
class in $R^1\pi_*\Omega^1_{\XX/U}\tensor\Omega^1_U$ represented by
the cocycle
$$h_{12}=h_{21}=0\qquad h_{23}=-h_{32}=h_{13}=-h_{31}=
-\frac{1+v}{u^{i+j}}\frac{dv}{v}\frac{dt}{t-1}.$$

We recall an explicit form of the trace map
$H^1(X,\Omega^1_X)\cong K$ in Cech cohomology for $X$ a curve over a
field $K$. 
Given a class $c$ represented by a cocycle $h_{\alpha\beta}$
for an affine cover $\{U_\alpha\}$,
choose {\it meromorphic\/} 1-forms $\sigma_\alpha$ on $U_\alpha$ so that
\begin{equation}\label{eq:cocycle}
h_{\alpha\beta}=\sigma_\alpha-\sigma_\beta
\end{equation}
on $U_{\alpha\beta}$. Then if $P\in X$ is a closed point, choose an
$\alpha$ so that $P\in U_\alpha$ and set $r_P=\res_P(\sigma_\alpha)$.
The cocycle condition \eqref{eq:cocycle} shows that $r_P$ does not
depend on the choice of $\alpha$. The trace map then sends $c$ to
$\sum_Pr_P\in K$.

We apply this explicit trace map to the generic fiber of our
family $\XX\to U$. We may choose
$$\sigma_1=\sigma_2=0\qquad\sigma_3=
\frac{1+v}{u^{i+j}}\frac{dv}{v}\frac{dt}{t-1}.$$ It is clear that
$r_P=0$ except possibly at the points $(u,v)=(0,-1)$ and $(0,-1/t)$ in
(the generic fiber of) $\XX_3$. A short computation reveals that the
residue is zero at $(0,-1)$, and at $(0,-1/t)$ it is
$$\begin{cases}
\frac{r\,dt}{t(t-1)}&\text{if $i+j=r$}\\
0&\text{if $i+j\neq r$.}
\end{cases}
$$
Since $r$ and $t(t-1)$ are units in $R$, this proves that the pairing 
\begin{align*}
H^0(U,\pi_*\Omega^1_{\XX/U})&\times H^0(U,\pi_*\Omega^1_{\XX/U})&&\to
&H^0(U,\Omega^1_U)\\
\omega_i&\times\omega_j&&\mapsto&(\omega_i,\omega_j)\quad
\end{align*}
is a perfect pairing of free $R$-modules.  This completes the proof of
Proposition~\ref{prop:KS}.

[There should be a calculation of $KS$ for Legendre ($r=2$) in the
literature which can be quoted as a reality check.]

\subsection{A compatibility}
In this section we prove a compatibility between the Kodaira-Spencer
maps of a family of curves and the corresponding family of Jacobians.
[This is surely well-known and there should be an off-the-shelf reference,
but it was easier to just write it down.]

Let $V$ be a smooth (possibly open) curve over a field $k$ and let
$\pi:\YY\to V$ be a surjective morphism whose geometric fibers are smooth
projective curves of genus $g$,  As in Section~\ref{s:KS}, we have a
Kodaira-Spencer map $KS_\YY:\pi_*\Omega^1_{\YY/V}\to
R^1\pi_*\OO_{\YY}\tensor\Omega^1_V$.

Let $\tau:\JJ\to V$ be the family of Jacobian varieties attached to
$\pi$, so $\tau$ is a smooth, projective family of abelian varieties
of dimension $g$ and the fibers of $\tau$ are the Jacobians of the
corresponding fibers of $\pi$.  There is a Kodaira-Spencer map
associated to $\tau$, denoted $KS_\JJ:\tau_*\Omega^1_{\JJ/V}\to
R^1\tau_*\OO_{\JJ}\tensor\Omega^1_V$, defined in an entirely analogous
manner [mentioned in the proof below].

Now assume that $\pi:\YY\to V$ has a section.  Using it, we have the
Abel-Jacobi map $AJ:\YY\to\JJ$, which is a closed immersion of schemes
over $V$.  The associated structure map $\OO_\JJ\to AJ_*\OO_{\YY}$
induces a morphism
$$R^1\tau_*\OO_{\JJ}\to R^1\tau_*\left(AJ_*\OO_\YY\right)
\cong R^1\pi_*\OO_\YY$$ which is known to be an isomorphism of locally
free sheaves of rank $g$ on $V$. (In the second isomorphism above and
several places below, we use that $AJ_*$ is exact because $AJ$ is a a
closed immersion.)

Similarly, the pull-back map on 1-forms $\Omega^1_{\JJ/V}\to
AJ_*\Omega^1_{\YY/V}$ induces a morphism
$$\tau_*\Omega^1_{\JJ/V}\to
\tau_*AJ_*\Omega^1_{\YY/V}\cong\pi_*\Omega^1_{\YY/V}$$
which is also known to be an isomorphism of locally free sheaves of rank
$g$ on $V$.

The compatibility we need is the following.

\begin{lemma}\label{lemma:KS-comp}
The diagram of locally free $\OO_V$-modules:
$$\xymatrix{
\tau_*\Omega^1_{\JJ/V}\ar[rr]^{KS_\JJ}\ar[d]&&R^1\pi_*\OO_{\JJ}\tensor\Omega^1_V\ar[d]\\
\pi_*\Omega^1_{\YY/V}\ar[rr]^{KS_\YY}&&R^1\pi_*\OO_{\YY}\tensor\Omega^1_V
}$$
commutes.  Here the vertical maps are the isomorphisms described above.
\end{lemma}

\begin{proof}
Consider the short exact sequence of $\OO_\YY$-modules
$$0\to\pi^*\Omega^1_V\to\Omega^1_\YY\to\Omega^1_{\YY/V}\to0.$$
Applying the exact functor $AJ_*$, we get a short exact sequence of
$\OO_\JJ$-modules
$$0\to AJ_*\pi^*\Omega^1_V\to AJ_*\Omega^1_\YY\to
AJ_*\Omega^1_{\YY/V}\to0.$$
Note that by the projection formula,
$AJ_*\pi^*\Omega^1_V\cong\tau^*\Omega^1_V\tensor AJ_*\OO_\YY$.
Using that isomorphism and pull back maps, we get a commutative
diagram of $\OO_\JJ$-modules
$$\xymatrix{
0\ar[r]&\tau^*\Omega^1_V\ar[r]\ar[d]&
\Omega^1_\JJ\ar[r]\ar[d]&\Omega^1_{\JJ/V}\ar[r]\ar[d]&0\\
0\ar[r]&\tau^*\Omega^1_V\tensor AJ_*\OO_\YY\ar[r]&
AJ_*\Omega^1_\YY\ar[r]&AJ_*\Omega^1_{\YY/V}\ar[r]&0.}$$
Now we apply $\tau_*$ and take a portion of the resulting morphism of
long exact sequences to get a commutative diagram:
$$\xymatrix{
  \tau_*\Omega^1_{\JJ/V}\ar[r]\ar[d]&R^1\tau_*\OO_\JJ\tensor\Omega^1_V\ar[d]\\
  \tau_*AJ_*\Omega^1_{\YY/V}\ar[r]&R^1\tau_*AJ_*\OO_\YY\tensor\Omega^1_V.}$$
But we already noted that
$\tau_*AJ_*\Omega^1_{\YY/V}\cong\pi_*\Omega^1_{\YY/V}$ and
$R^1\tau_*AJ_*\OO_\YY\cong R^1\pi_*\OO_\YY$, so we have a commutative
diagram
$$\xymatrix{
\tau_*\Omega^1_{\JJ/V}\ar[r]\ar[d]&R^1\tau_*\OO_\JJ\tensor\Omega^1_V\ar[d]\\
\pi_*\Omega^1_{\YY/V}\ar[r]&R^1\pi_*\OO_\YY\tensor\Omega^1_V.}$$
The vertical arrows are the isomorphisms described before the
statement of the lemma and the horizontal maps are (by definition) the
Kodaira-Spencer maps of $\JJ$ and $\YY$, so we have proved the desired result.
\end{proof}


\begin{cor}\label{cor:KS-JJ}
Let $\JJ\to U$ be the family of Jacobians associated to the curve
$\XX\to U$ described in Section~\ref{s:model}.  Then the
Kodaira-Spencer map
$$\Omega^1_{\JJ/U}\to R^1\tau_*\OO_\JJ\tensor\Omega^1_U$$ 
is an isomorphism of locally free $\OO_U$-modules of rank $g=r-1$.
\end{cor}


\subsection{$p$-torsion}
Now assume that $p>0$. Combining Corollary~\ref{cor:KS-JJ}, the
ordinarity of $J_X$ (proved by Rachel), and the Proposition on page
1093 of Voloch, {\it American Journal of Mathematics\/} {\bf 117}
(1995), we have reached our goal:

\begin{prop}
We have $J_X(K)[p]=J_X(K^{sep})[p]=0$.
\end{prop}

\begin{rem} 
  This proof is not so simple. Unfortunately, it seems
  unlikely that the more straightforward idea of using $p$-descent
  will yield the desired result. In the Legendre case ($r=2$), the
  $p$-part of $\sha$ is often non-trivial and I would expect the same
  to be true for $r>2$. 
\end{rem}













\section{Regular model at infinity}
%{Jenn Park \and Shahed Sharif}


In this section, we will assume that $r \geq 3$. We will now compute the minimal proper regular model of $C$ at $t = \infty$, as well as the component group. In all of the following, we test regularity of various affine charts. These charts will be given by a single equation in $\mathbb{A}^3_k$ of the form $f(x_1,x_2,x_3) = g(x_1,x_2,x_3)$. We will make frequent use of the fact that a point $P_0$ on the surface so given is regular if and only if $\frac{\partial f}{\partial x_i}(P_0) \neq \frac{\partial g}{\partial x_i}(P_0)$ for some $i$.

\subsection{Desingularization}
\label{sec:desingularization}

Let $T = \frac{1}{t}$. Then the integral model of $C$ from \S~\ref{s:model} can be written
\begin{align*}
  \XX_1&: Ty = x^{r-1}(xy+T)(xy+1) \\
  \XX_2&: Tz = w^{r-1}(w+zT)(w+z) \\
  \XX_3&: Tu^rv = (v+1)(v+T).
\end{align*}
Recall that the gluing is given by
\[
(x,y)=(w,1/z)\qquad(w,z)=(1/u,v/u)\qquad(u,v)=(1/x,1/(xy)).
\]


The special fibers on these charts, given by $T = 0$, are as follows:
\[
\begin{array}{l@{:\,\,}ll}
\XX_1 & x^ry(xy+1) = 0 & R_1, C_2, C_1 \\
\XX_2 & w^r(w + z) = 0 & R_1, C_1 \\
\XX_3 & v(v + 1) = 0 & C_2, C_1.
\end{array}
\]
The third column gives names for the components of the special fiber, given in order of the factors in the equation. For example, in $\XX_1$, $C_2$ is given by the equation $y = 0$ (and $T = 0$, which holds for every component). The components $C_1$ and $C_2$ each have multiplicity 1, while $R_1$ has multiplicity $r$. Let $P = C_1 \cap R_1$. Note that $P$ lies in the chart $\XX_2$, but in no others. Let $Q = C_2 \cap R_1$. Then $Q$ lies in $\XX_1$ but in no other chart. One checks that every point but $P$ and $Q$ is regular. Therefore we need to blow up at these two points.

One remark: the reason behind the notation $R_1$ will become apparent in \S~\ref{sec:blow-up-Q}.

\subsection{Blowing-up}
\label{sec:blowing-up}

\subsubsection{Blow-up at $P$.}
\label{sec:blow-up-P}

We first blow up at $P$, which is given by $(w,z,T) = (0,0,0)$. The blow-up is given by two charts. The first chart is computed via the change of variables
\[
w = zw' \qquad T = z\tau.
\]
We obtain the arithmetic surface with equation
\[
\tau = z^{r-1}w'^{r-1}(w' + z\tau)(w' + 1).
\]
This has special fiber given by $T = z\tau = 0$, with components
\begin{align*}
  \tilde{C_1}&: (w' + 1 = \tau = 0) \\
  \tilde{R_1}&: (w' = \tau = 0) \\
  D_r&: (z = \tau = 0).
\end{align*}
In the above, $\tilde{C_1}$, $\tilde{R_1}$ are the strict transforms of $C_1$, $R_1$ respectively with the same multiplicities as before. To compute the multiplicity of the third component $D_r$, we consider the ring
\[
{k[z,w',\tau]_{(z,\tau)}}/{(z^{r-1}w'^{r-1}(w' + z\tau)(w' + 1) - \tau)}.
\]
This is the local ring for the subscheme $D_r$. Since $D_r$ is a prime divisor, the local ring is a discrete valuation ring $\sO_{C,D_r}$ with valuation, say, $\nu$. Then the multiplicity of $D_r$ in the special fiber is $\nu(T) = \nu(z\tau)$. But this valuation equals the length of the Artinian ring
\[
{\sO_{C,D_r}}/{(z\tau)}.
\]
Let $\alpha = w'^{r}(w'+1)$. Then the above ring equals
\[
{k[z,w',\tau]_{(z,\tau)}}/{(\alpha z^{r-1} - \tau, z\tau)}.
\]
The first expressions allows us to substitute $\tau = \alpha z^{r-1}$. The second expression then becomes $\alpha z^r$. Since $\nu(\alpha) = 0$, our Artinian ring is isomorphic to
\[
{k[z,w']_{(z)}}/{(z^r)}.
\]
Therefore the multiplicity of $D_r$ in the special fiber is $r$.

The intersection points are $P_1 = \tilde{C_1} \cap D_r$ given by $z=w'+1=\tau=0$, and $P_z = \tilde{R_1} \cap D_r$ given by $z=w'=\tau=0$. (Observe that $\tilde{C_1} \cap \tilde{R_1} = \emptyset$.) Writing the equation for our surface as
\[
z^{r-1}w'^{r-1}(w' + z\tau)(w' + 1) - \tau = 0
\]
and taking the $\tau$ derivative on the left, we obtain
\[
z^rw'^{r-1}(w' + 1) - 1.
\]
We now observe that this expression equals $-1$ at both $P_1$ and $P_z$. Therefore both points are regular.

Now we compute the second chart. This chart is given by the change of variables
\[
z=wz' \qquad T=w\tau'
\]
whence we obtain the equation
\[
z'\tau' = w^{r-1}(1 + wz'\tau')(1 + z').
\]
The special fiber is given by $T = w\tau' = 0$, which gives us the components
\begin{align*}
  \tilde{C_1}&: (1 + z' = \tau' = 0) \\
  D_r&: (w = \tau' = 0) \\
  D_1&: (w = z' = 0).
\end{align*}
Observe that $D_1$ has multiplicity $1$. The intersection $\tilde{C_1} \cap D_r$ occurs when $1 + z' = \tau' = w = 0$. One checks that this intersection point is in fact $P_1$. The intersection $D_r \cap D_1$ occurs when $z' = \tau' = w = 0$. But now note that $z' = \frac{1}{w'}$. Therefore this intersection point is distinct from $P_2$. (Or easier: $\tilde{R_1}$ does not appear in this chart for the same reason.) We call this new point $P_3$. One checks that $P_3$ is \emph{not} regular.

In order to resolve $P_3$, we will desingularize inductively. To ease notation, write $\alpha$ for $(1 + wz'\tau')(1 + z')$, so that
\begin{itemize}
    \item the chart containing $P_3$ has equation $z'\tau' = \alpha w^{r-1}$,
    \item $\alpha(P_3) \neq 0$, and
    \item $T = w\tau'$.
\end{itemize}

We now desingularize by replacing $P_3$ with 2 charts. The first chart is given by
\[
\tau'' = \alpha z'^{r-3} w''^{r-1}
\]
where $\tau' = z' \tau''$ and $w = z' w''$, whence $T = z'^2 \tau'' w''$. The special fiber consists of 2 components, one given by $\tau'' = w'' = 0$ and of multiplicity $r$, the other given by $\tau'' = z' = 0$ having multiplicity $r-1$. One verifies that the first component is $D_r$; the second component, which we call $D_{r-1}$, is exceptional; and the intersection is transverse. Furthermore, taking the $\tau''$ derivative shows that this chart is regular.

  The second chart is given by $z'' \tau' = \alpha w^{r-2}$, where $z' = z'' w$. The special fiber then consists of the components $\tau' = w = 0$ with multiplicity $r-1$ and $z'' = w = 0$ with multiplicity $1$. One verifies that these are $D_{r-1}$ and $D_1$ respectively. The intersection point is regular if and only if $r = 3$, in which case the claim is proved. If $r > 3$, then we are in essentially the same situation as with $P_3$ except that $z'$ has become $z''$ and $r$ has been replaced with $r-1$. We can therefore iterate, thus obtaining a ``tail'' of rational curves $D_r, D_{r-1}, \dots, D_1$, each crossing transversely with adjacent curves in the list, and such that $D_i$ has multiplicity $i$ in the special fiber.


\subsubsection{Blow-up at $Q$.}
\label{sec:blow-up-Q}

Recall that $Q$ lies on the affine chart with equation
\begin{equation}
  \XX_1:yT = x^{r-1}(xy + T)(xy + 1)\label{eq:C'''},
\end{equation}
is the intersection point of the components $C_2$ and $R_1$, and has coordinates $(x,y,T) = (0,0,0)$. Just as in the case of $P$, we will desingularize at $Q$ recursively; however, the situation is rather more complicated.  

One should keep in mind the following: blowing-up is a local procedure; and $xy + 1 = T = 0$ is an equation for $C_1$, a component which does not pass through $Q$. Therefore, the factor $xy + 1$ and its transforms can be safely ignored when computing special fibers below.

We start by replacing $Q$ with two charts. Chart 1 is given by the equation
\[
T' = b^{r-1}y^{r-2}(by + T')(by^2 + 1)
\]
where $x = by$ and $T = T'y$. The special fiber consists of 2 components:
\begin{itemize}
    \item $R_1: T' = b = 0$ with multiplicity $r$, and
    \item $R_2: T' = y = 0$ also with multiplicity $r$.
\end{itemize}
The first component is in fact identical to the $R_1$ appearing in \S~\ref{sec:blow-up-P} and earlier. The second component is exceptional. By considering the $T'$ derivative, one sees that this chart is regular.

Chart 2 is given by the equation
\[
y_1 T_1 = x^{r-2}(x y_1 + T_1)(x^2 y_1 + 1)
\]
where $y = y_1 x$ and $T = T_1 x$. The special fiber consists of three components:
\begin{itemize}
    \item $C_2: T_1 = y_1 = 0$ with multiplicity $1$,
    \item $R_2: T_1 = x = 0$ with multiplicity $r$, and
    \item $E_1: x = y_1 = 0$ with multiplicity $1$.
\end{itemize}
The third component is exceptional. The intersection point $Q_1$ has coordinates $(x, y_1, T_1) = (0,0,0)$ and, if $r \geq 3$, is \emph{not} regular.

We therefore continue by blowing-up chart 2. We do this recursively as follows. For $1 \leq i \leq r-3$, let chart $\XX_1(i)$ be the chart given by
  \[
  y_i T_i = x^{r-i-1} (x y_i + T_i) (x y_i^{i+1} + 1).
  \]
  Let $T = T_i x^i$. Then the special fiber ($T = 0$) consists of the components
  \begin{itemize}
      \item $C_2: T_i = y_i = 0$ with multiplicity 1,
      \item $R_{i+1}: T_i = x = 0$ with multiplicity $r$, and
      \item $E_i: x = y_i = 0$ with multiplicity $i$.
  \end{itemize}
  Note that chart 2 is the same as chart $\XX_1(1)$. One verifies that this chart is nonregular only at $Q_i: (x, y_i, T_i) = (0, 0, 0)$. We blow up $Q_i$ via 3 charts.

  The first chart is $\XX_1(i+1)$, which we glue to $\XX_1(i)$ away from $Q_i$ using $y_i = x y_{i+1}$ and $T_i = x T_{i+1}$. One verifies that this is consistent with the construction above.

  The second chart is $\XX_1(i)'$ given by $y_i = y_i' T_i$ and $x = x_i' T_i$. Then $T = x_i'^i T_i^{i+1}$. Our chart is given by
  \[
  y_i' = x_i'^{r-i-1} T_i^{r-i-2} (x_i' y_i' T_i + 1) (x_i'^{i+1} y_i' T_i^{i+2} + 1).
  \]
  The special fiber consists of
  \begin{itemize}
      \item $E_i: x_i' = y_i' = 0$ with multiplicity $i$, and
      \item $E_{i+1}: T_i = y_i' = 0$ with multiplicity $i+1$.
  \end{itemize}
  By computing the $y_i'$ derivative, one checks that this chart is regular.

  The third chart is $\XX_1(i)''$ given by $x = x_i'' y_i$ and $T_i = y_i T_i'$. Then $T = y_i^{i+1} x_i''^i T_i'$ and the equation is
  \[
  T_i' = x_i''^{r-i-1} y_i^{r-i-2} (x_i'' y_i + T_i') (x_i''^{i+1} y_i^{i+2} + 1).
  \]
  The chart is regular (take the $T_i'$ derivative) and the special fiber has components
  \begin{itemize}
      \item $R_{i+1}: T_i' = x_i'' = 0$ with multiplicity $r$, and
      \item $R_{i+2}: T_i' = y_i = 0$ with multiplicity $r$.
  \end{itemize}

  The remaining and, as it will turn out, final case occurs when $i = r - 2$. (Note that this is the only case we need consider when $r = 3$.) In this case, we have chart $\XX_1(r-2)$ given by
  \[
  y_{r-2} T_{r-2} = x (x y_{r-2} + T_{r-2}) (x^{r-1} y_{r-2} + 1)
  \]
  with $y_{r-2}, T_{r-2}$ given as above, and $T = T_{r-2} x^{r-2}$. We blow up as before; that is, construct the charts $\XX_1(r-1)$, $\XX_1(r-2)'$ and $\XX_1(r-2)''$ as above. We now verify that there are two differences: every chart is regular, and the special fibers for $\XX_1(r-1)$ and $\XX_1(r-2)''$ differ from the cases for smaller $i$.

  For chart $\XX_1(r-1)$, the equation is
  \[
  y_{r-1} T_{r-1} = (x y_{r-1} + T_{r-1}) (x^{r} y_{r-1} + 1)
  \]
  and $T = T_{r-1} x^{r-1}$. The special fiber consists of the components
  \begin{itemize}
      \item $C_2: T_{r-1} = y_{r-1} = 0$ with multiplicity 1, and
      \item $E_r: T_{r-1} = x = 0$ with multiplicity $r$.
  \end{itemize}
  One checks that the $T_{r-1}$ partial derivative gives equality if and only if $x = 0$ and $y_{r-1} = 1$. But plugging these values into the $x$-derivative yields an inequality. Therefore this chart is regular.

  For chart $\XX_1(r-2)'$, the equation is
  \[
  y_i' = x_i' (x_i' y_i' T_{r-2} + 1) (x_i'^{r-1} y_i' T_i^{r} + 1)
  \]
  with special fiber consisting of the components
  \begin{itemize}
      \item $E_{r-2}: x_i' = y_i' = 0$ with multiplicity $r-2$, and
      \item $E_{r-1}: T_{r-2} = y_i' - x_i' = 0$ with multiplicity $r-1$.
  \end{itemize}
  The argument for regularity is the same as for the general charts $\XX_1(i)'$.

  Finally, the chart $\XX_1(r-2)''$ is given by
  \[
  T_i' = x_i'' (x_i'' y_{r-2} + T_i') (x_i''^{r-1} y_{r-2}^{r} + 1)
  \]
  with special fiber consisting of the components
  \begin{itemize}
      \item $R_{r-1}: T_i' = x_i'' = 0$ with multiplicity $r$,
      \item $E_r: T_i' = y_{r-2} = 0$ with multiplicity $r$, and
      \item $E_{r-1}: y_{r-2} = x_i'' - 1 = 0$ with multiplicity $r-1$.
  \end{itemize}
  Checking the $T_i'$ derivative, we see that we have equality only along $E_{r-1}$. But the $y_{r-2}$ derivative along $E_{r-1}$ always yields an inequality. Therefore this chart is regular.

  Let $\scd$ be the resulting regular model for $C$, and write $C_k$ for its special fiber at $T = 0$.

\subsubsection{Dual graph}
\label{sec:dual-graph}

Recall that the dual graph of $C_k$ is defined to be the graph such that the set of irreducible components of $C_k$ is the set of vertices, and the set of intersection points between two such components is the set of edges between the corresponding vertices. Putting our calculations above together, we obtain
\begin{proposition}\label{prop:dual-graph-plus-multiplicities}
  The dual graph for $C_k$ is given by Figure~\ref{fig:superelliptic-dual-graph}. All intersections are transverse. The components $C_1$ and $C_2$ have multiplicity $1$, the $R_i$ each have multiplicity $r$, and the $D_i$ and $E_i$ have multiplicity $i$.
\begin{figure}[h]\centering
\[
\xygraph{
  !{<0cm,0cm>;<1.5cm,0cm>:<0cm,1.25cm>::}
  !{(1,5) }*{\bullet}="r1"
  !{(2,5) }*{\bullet}="r2"
  !{(3,5) }*{\quad\cdots\quad}="rspace"
  !{(4,5) }*{\bullet}="rrm"
  !{(1,5.6) }*{R_1}
  !{(2,5.6) }*{R_2}
  !{(4,5.6) }*{R_{r-1}}
  !{(0,4) }*{C_1\;\bullet}="c1"
  !{(5,4) }*{\bullet\; C_2}="c2"
  !{(1,0) }*{\bullet}="d1"
  !{(1,1) }*{\bullet}="d2"
  !{(1,1.5) }*{}="dbelow"
  !{(1,2.1) }*{\vdots}="dspace"
  !{(1,2.6) }*{}="dabove"
  !{(1,3) }*{\bullet}="drm"
  !{(1,4) }*{\bullet}="dr"
  !{(.6,0) }*{D_1}
  !{(.6,1) }*{D_2}
  !{(.5,3) }*{D_{r-1}}
  !{(1.4,4) }*{D_r}
  !{(4,0) }*{\bullet}="e1"
  !{(4,1) }*{\bullet}="e2"
  !{(4,1.5) }*{}="ebelow"
  !{(4,2.1) }*{\vdots}="espace"
  !{(4,2.6) }*{}="eabove"
  !{(4,3) }*{\bullet}="erm"
  !{(4,4) }*{\bullet}="er"
  !{(4.4,0) }*{E_1}
  !{(4.4,1) }*{E_2}
  !{(4.6,3) }*{E_{r-1}}
  !{(3.6,4) }*{E_r}
  "r1"-"r2"
  "r2"-"rspace"
  "rspace"-"rrm"
  "r1"-"dr"
  "c1"-"dr"
  "dr"-"drm"
  "drm"-"dabove"
  "dbelow"-"d2"
  "d2"-"d1"
  "rrm"-"er"
  "c2"-"er"
  "er"-"erm"
  "erm"-"eabove"
  "ebelow"-"e2"
  "e2"-"e1"
}
\]


\caption{Dual graph of $C_k$}
\label{fig:superelliptic-dual-graph}
\end{figure}
\end{proposition}


\subsection{Minimality}
\label{sec:minimality}

Next we must make sure our model is minimal. We first base-extend to the strict henselization of $\F_q[T]$ at $T = 0$, noting that unramified base-change affects neither minimality of models nor intersection numbers. Now we may apply Castelnuovo's criterion to check that $\scd$ is a minimal model; this amounts to checking no component isomorphic to $\Pro^1$ has self-intersection $-1$ (see~Prop.~IV.7.5 in~\cite{silvermanATAEC}). Every irreducible component is isomorphic to $\Pro^1$, so it remains to check the self-intersections. 

To compute these self-intersections we use the fact that if $D$ is a fibral divisor and $C_k$ is the special fiber, then $C_k \cdot D = 0$ (see Prop.~IV.7.3 in~\cite{silvermanATAEC}). In our case, all of the geometric intersections are transverse, so we can simplify the calculation of self-intersection numbers as follows.
\begin{proposition}\label{prop:transverse-self-intersections}
  Let $\scd$ be a regular arithmetic surface proper over a discrete valuation ring, and let $C_k$ be the special fiber. Let $C_k^{\sf red}$ be the associated reduced scheme. Suppose that every singular point of $C_k^{\sf red}$ consists of a transverse crossing of two irreducible components. Let $V$ be an irreducible component of $C_k$. Label the remaining irreducible components $V_1, V_2,$ etc. Then
  \[
  V^2 = -\frac{1}{m} \sum m_i n_i
  \]
  where $m$ is the multiplicity of $V$, $m_i$ is the multiplicity of $V_i$, and $n_i$ is the number of intersection points of $V$ and $V_i$.
\end{proposition}

\begin{proof}
  The total fiber is
  \[
  C_k = mV + \sum m_i V_i.
  \]
  Since $V \cdot C_k = 0$, we have
  \begin{align*}
    0 &= V \cdot C_k \\
    &= mV^2 + \sum m_i (V \cdot V_i) \\
    &= mV^2 + \sum m_i n_i
  \end{align*}
  from which the claim follows.
\end{proof}

\begin{proposition}\label{prop:self-intersect-superelliptic}
  Let $\scd$ be the model constructed in sections \S~\ref{sec:blowing-up} with special fiber described in Prop.~\ref{prop:dual-graph-plus-multiplicities}. Then
  \begin{enumerate}
      \item $C_1^2 = C_2^2 = -r$, and
      \item $R_i^2 = D_i^2 = E_i^2 = -2$ for all $i$.
  \end{enumerate}
\end{proposition}

\begin{proof}
  We use the notation of Prop.~\ref{prop:transverse-self-intersections}. Inspection of Figure~\ref{fig:superelliptic-dual-graph} shows that for any choice of $V$ and $V_i$, $n_i$ is either $0$ or $1$. For $V = C_1$ we have $m = 1$. This component only intersects $D_r$, which has multiplicity $r$. The claim for $C_1$ follows. Similar reasoning holds for $C_2$.

  For $V = R_i$, we have $m = r$. Also, $R_i$ intersects exactly two other components, both with multiplicity $r$. We thus obtain $R_i^2 = -2$.

  For $V = D_i$, $1 < i < r$, we have $m = i$. Also, $D_i$ intersects $D_{i-1}$ and $D_{i+1}$ which have multiplicities $i-1$ and $i+1$ respectively. Now Prop.~\ref{prop:transverse-self-intersections} gives us $D_i^2 = -2$.

  For $V = D_1$, $m = 1$ and $D_1$ only intersects $D_2$, which latter has multiplicity $2$. Again we get $D_1^2 = -2$.

  For $V = D_r$, $m = r$, and $D_r$ intersects $D_{r-1}, C_1$, and $R_1$ with multiplicities $r-1$, $1$, and $r$ respectively. We obtain $D_r^2 = -2$.

  The argument for the $E_i$ is completely analogous.
\end{proof}



\subsection{Component group}
\label{sec:component-group}

To compute the component group of the Jacobian of a curve, one typically first base-extends to a strictly henselian ring. The following result of Bosch-Liu allows us to do so without complication.

\begin{proposition}[Corollary~1.8 in \cite{bosch-liu1999}]\label{prop:bosch-liu-phi-constant}
  Let $K$ be the fraction field of a discrete valuation ring $R$ with residue field $k$. Let $C/K$ be a smooth proper geometrically integral curve, and $\scd/R$ a minimal proper regular model for $C$. Let $J$ be the Jacobian of $C$, and $\sj/R$ its N\'eron model. The connected components of the special fiber of $\sj$ form a finite \'etale group scheme $\Phi$ over $k$. If every component of the special fiber of $\scd$ is geometrically irreducible, then $\Phi$ is a constant group scheme.
\end{proposition}

The background material in the remainder of this section can be found in~\cite[Ch. 9]{blr}. In the latter, the authors define the \emph{geometric multiplicity} of a component of the special fiber, and use the notation $e_i$. Our base field is algebraically closed, and it follows that all geometric multiplicities are $1$. (See \cite[Defn~9.1.3]{blr}.)

In order to compute the component group at $\infty$ of $C$, we make use of the \emph{intersection matrix} of the special fiber. This is the matrix whose $(i,j)$ entry is the intersection number $(V_i \cdot V_j)$, where $V_i$ is some labeling of the irreducible components of the special fiber. We will order the components as follows: $D_1, D_2, \dots, D_r, R_1, \dots, R_{r-1}, E_r, \dots, E_1, C_1, C_2$. As all intersections are transverse and distinct components in $C_k$ intersect at most once (see Figure~\ref{fig:superelliptic-dual-graph}), the off-diagonal entries of the intersection matrix are $1$ if the two corresponding components meet and $0$ otherwise. The self-intersections were computed in Prop.~\ref{prop:self-intersect-superelliptic}. Therefore the intersection matrix is
\[
A = \left[\begin{array}{rrrrrrrrr|rr}
  -2 & 1 & & & & & & & & & \\
  1 & -2 & 1 & & & & & & & & \\
  & 1 & -2 & 1 & & & & & & & \\
  & & & & & & & & & & \\
  & & & & & & & & & 1 & \\
  & & & & & \ddots & & & & \vdots & \\
  & & & & & & & & & & 1 \\
  & & & & & & & & & & \\
  & & & & & & & 1 & -2 & & \\ \hline
  & & & & 1 & \dots & & & & -r & \\
  & & & & & & 1 & & & & -r
\end{array}\right].
\]
The $1$s in the upper right rectangle in the matrix occur at rows $r$ and $2r$---that is, at the rows corresponding to $D_r$ and $E_r$. The $1$s in the lower left rectangle similarly occur at the $r$th and $2r$th columns respectively. The component group can then be computed via the following.
\begin{thm}[Corollary 9.6.3 of \cite{blr}]\label{thm:elementary-divisors-comp-group}
  Suppose that $\scd$ is a flat, proper relative curve over a strictly henselian discrete valuation ring. Suppose also that $\scd$ is generically geometrically irreducible and that the residue field is algebraically closed. Let $n_1, \dots, n_{v-1}, 0$ be the elementary divisors of the intersection matrix $A$ for the special fiber of $\scd$. Let $J$ be the Jacobian of the generic fiber of $\scd$. Then the group of connected components of the N\'eron model of $J$ is isomorphic to
  \[
  {\Z}/{n_1\Z} \oplus \cdots \oplus {\Z}/{n_{v-1}\Z}.
  \]
\end{thm}
Implicit in the statement of the theorem is that the intersection matrix has rank $r-1$. In our case, one can at least see that the vector of multiplicities $(1,2,\dots,r,r,\dots,r,r-1,\dots,2,1,1,1)$ lies in the kernel of $A$; in fact, one can use the identity $D \cdot C_k = 0$ mentioned earlier to show that this holds in general.

We must therefore compute the elementary divisors of $A$. Recall that the elementary divisors are the diagonal entries in the Smith normal form of $A$. The Smith normal form is a diagonal matrix obtained from $A$ via a combination of elementary row and column operations which are invertible over $\Z$.

\paragraph{Step 1:}
\label{sec:step-1}

For $i = 1, \dots, 3r-3$ in turn, we do the following column operations:
\begin{itemize}
    \item Add twice column $i$ to column $i+1$.
    \item Subtract column $i$ from column $i+2$.
\end{itemize}
We then add twice column $3r-2$ to column $3r-1$. An easy induction shows that the resulting matrix is
\[
\left[\begin{array}{rrrrrrrr|rr}
  -2 & -3 & & & \dots & & & -3r & & \\
  1 & & & & & & & & & \\
  & 1 & & & & & & & & \\
  & & & & & & & & 1 & \\
  & & & & \ddots & & & & & \\
  & & & & & & & & & 1 \\
  & & & & & & 1 & 0 & & \\ \hline
  & & 1 & 2 & & \dots & & 2r & -r & \\
  & & & & 1 & 2 & \dots & r & & -r
\end{array}\right].
\]
Once again, the $1$s in the upper right rectangle occur at rows $r$ and $2r$ respectively, and the $1$s in the lower left rectangle occur in columns $r$ and $2r$ respectively.

\paragraph{Step 2:}
\label{sec:step-2}

We now subtract column $r-1$ from column $3r$ (the second column from the right), and subtract column $2r-1$ from column $3r+1$:
\[
\left[\begin{array}{rrrrrrrr|rr}
  -2 & -3 & & & \dots & & & -3r & r & 2r \\
  1 & & & & & & & & & \\
  & 1 & & & & & & & & \\
  & & & & \ddots & & & & & \\
  & & & & & & 1 & 0 & & \\ \hline
  & & 1 & 2 & & \dots & & 2r & -r & -r \\
  & & & & 1 & 2 & \dots & r & & -r
\end{array}\right].
\]

\paragraph{Step 3:}
\label{sec:step-3}

By the obvious row operations, we can zero out the first $3r-2$ entries of the first row and the last two rows. We then rearrange rows to obtain
\[
\left[\begin{array}{c|rrr}
  I & & & \\ \hline
  & -3r & r & 2r \\
  & 2r & -r & -r \\
  & r & & -r
\end{array}\right].
\]
Here $I$ denotes the $(3r-2) \times (3r-2)$ identity matrix. By Theorem~\ref{thm:elementary-divisors-comp-group}, we may consider only the $3 \times 3$ block in the bottom right and omit everything else. A short calculation shows that the Smith normal form for this latter block is
\[
\begin{bmatrix}
  r & & \\
  & r & \\
  & & 0
\end{bmatrix}.
\]
Now applying Theorem~\ref{thm:elementary-divisors-comp-group}, we obtain
\begin{thm}
  Let $C$ be the complete nonsingular curve birational to the affine curve with equation $\caff:Txy^r = (x+1)(Tx+1)$ over $K$, with $r \geq 3$. Let $\scd$ be the minimal proper regular model for $C$ at $T = 0$. Let $J$ be the Jacobian for $C$. Then the component group for the N\'eron model of $J$ at $T = 0$ is isomorphic to
  \[
  {\Z}/{r\Z} \oplus {\Z}/{r\Z}.
  \]
\end{thm}


\section{Regular model at $t=1$}
\label{sec:regular-model-at-t-equals-one}

In this section, we compute the minimal proper regular model of $C$ at $t = 1$, as well as the component group. We will be working with the affine model
\[
\caff: (x_0 - 1) \sy^r = x_0(x_0 + t_0).
\]
This model is birational to the original model, $y^r = x^{r-1}(x+1)(x+t)$, via $\sy = y/x$, $x_0 = x + 1$, and $t_0 = t - 1$. The model is generically smooth away from infinity, and its projective closure has a cusp at infinity which can be desingularized by normalization. 

\subsection{Desingularization}
\label{sec:desingularization-t-equals-one}

We are concerned with the fiber $t_0 = 0$. Furthermore, there is a nonregular point at $(x_0, \sy, t_0) = (0, 0, 0)$. To resolve the singularity at $(x_0, \sy, t_0) = (0, 0, 0)$, we consider the family of charts
\[
(x_i\sy^i - 1) \sy^k = x_i(x_i + t_i)
\]
with central fiber $t_i\sy^i = 0$; call this chart $(i,k)$. Observe that our $\caff$ is exactly the chart $(0,r)$. For most values of $i, k$, the chart will be nonregular at exactly one point: $(x_i, \sy, t_i) = (0, 0, 0)$. As we will see, a blow-up results in 3 charts, 2 of which are regular, and the third of which is chart $(i+1, k-2)$. The process terminates when chart $(i, k)$ is regular; that is, for sufficiently small $k$. This will turn out to occur when $k = 0$ or $1$. We first study properties of the charts $(i, k)$ in 4 cases:
\begin{enumerate}
    \item The initial chart $(0, k)$ with $k = r$; in particular, $k \geq 3$.
    \item The terminal chart $(i, 0)$ with $i \geq 1$.
    \item The terminal chart $(i, 1)$ with $i \geq 1$.
    \item The generic chart $(i, k)$ with $i \geq 1$, $k \geq 2$.
\end{enumerate}
Once this is done, we demonstrate the recursive blow-up procedure.

\paragraph{Chart $(0, k)$ with $k \geq 3$:}
\label{sec:case-i=0}

If $i = 0$, we have $\caff$ with special fiber
\[
(x_0 - 1) \sy^k = x_0^2.
\]
The fiber is irreducible with multiplicity $1$, and we call it $F$. One checks that $F$ intersects itself at point $(x_0, \sy) = (0, 0)$. As observed earlier, the only nonregular point on $\caff$ is given by $(x_0, \sy, t_0) = (0, 0, 0)$.

\paragraph{Chart $(i, 0)$ with $i \geq 1$:}
\label{sec:case-k=0}

The special fiber consists of two components:
\begin{itemize}
    \item $F_{i,0}: t_i = x_i^2 - x_i\sy^i + 1 = 0$ with multiplicity 1; and
    \item $G_{i,0}: \sy = x_i^2 + x_it_i + 1 = 0$ with multiplicity $i$.
\end{itemize}
These components intersect twice transversally, at $(x_i, \sy, t_i) = (\pm i, 0, 0)$. This chart is regular.



\paragraph{Chart $(i, 1)$ with $i \geq 1$:}
\label{sec:case-i-1}

The special fiber consists of 3 components:
\begin{itemize}
    \item $F_{i,1}: t_i = x_i^2 - x_i\sy^{i+1} + \sy = 0$ with multiplicity 1;
    \item $D_{i,1}: \sy = x_i = 0$ with multiplicity $i$; and
    \item $E_{i,1}: \sy = x_i + t_i = 0$ with multiplicity $i$.
\end{itemize}
These components intersect each other transversally at $(x_i, \sy, t_i) = (0,0,0)$, and nowhere else. This chart is regular.



\paragraph{Chart $(i, k)$ with $i\geq 1$, $k\geq 2$:}
\label{sec:higher-i-k}

The special fiber consists of 3 components:
\begin{itemize}
    \item $F_{i,k}: t_i = x_i^2 - x_i\sy^{i+k} + \sy^k = 0$ with multiplicity 1;
    \item $D_{i,k}: \sy = x_i = 0$ with multiplicity $i$; and
    \item $E_{i,k}: \sy = x_i + t_i = 0$ with multiplicity $i$.
\end{itemize}
The component $F_{i,k}$ has a node at $(x_i,\sy,t_i) = (0,0,0)$, and the other two components also pass through this point. This intersection point is not regular, but the rest of the chart is regular.

The only nonregular charts are $(0,k)$ and the last chart above. Thus we now investigate the blow-up of these charts at $(x_i,\sy,t_i) = (0,0,0)$. The first chart of the blow-up is obtained via $x_{i} = x_{i+1} \sy$, $t_{i} = t_{i+1} \sy$; one verifies that the resulting chart is $(i+1, k-2)$, where the strict transform of $F_{i,k}$ is $F_{i+1, k-2}$, and the other 2 components of chart $(i + 1, k-2)$ are exceptional. There are two more charts in the blow-up, however the specifics depend on whether $k=2$ or $k \geq 3$. In all cases, as we shall see, these charts are regular.

\paragraph{Chart $(i,k)_b$:}
\label{sec:chart-i-k_b}

Our next chart, which we call $(i,k)_b$, is obtained via $\sy = x_ib_i$, $t_i = x_i\tau_i$, whence the central fiber is given by $t_0 = x_i^{i+1}b_i^i\tau_i$. The resulting model is
\[
(x_i^{i+1}b_i^i - 1)x_i^{k-2} b_i^k = 1 + \tau_i.
\]
The special fiber has 3 components. When $k \geq 3$, one verifies that these are
\begin{itemize}
    \item $F_{i,k}: \tau_i = (x_i^{i+1}b_i^i - 1)x^{k-2} b_i^k - 1 = 0$ with multiplicity 1;
    \item $E_{i,k}: b_i = 1+\tau_i = 0$ with multiplicity $i$; and
    \item $E_{i+1,k}: x_i = 1+\tau_i = 0$ with multiplicity $i+1$.
\end{itemize}
Note that if $i = 0$, $E_{i,k}$ has multiplicity $0$; this actually means that the component does not exist in this case. Otherwise,
the components $E_{i,k}$ and $E_{i+1,k}$ cross transversally at $(x_i, b_i, \tau_i) = (0, 0, -1)$. The component $F_{i,k}$ does not intersect the others regardless of the value of $i$.

When $k = 2$, we get
\begin{itemize}
    \item $F_{i,2}: \tau_i = (x_i^{i+1}b_i^i - 1) b_i^2 - 1 = 0$ with multiplicity 1;
    \item $E_{i,2}: b_i = 1+\tau_i = 0$ with multiplicity $i$; and
    \item $G_{i+1,2}: x_i = 1+\tau_i+b_i^2 = 0$ with multiplicity $i+1$.
\end{itemize}
The intersection $E_{i,2} \cap G_{i+1,2}$ is transversal at $(0,0,-1)$, while $F_{i,2}$ intersects $G_{i+1,2}$ transversally at two points: $(x_i, b_i, \tau_i) = (0, \pm i, 0)$. One checks that these latter intersections are identical to those in chart $(i+1,0)$.

Independent of the value of $k$, one verifies that this chart is regular by computing the $\tau_i$-derivative.

\paragraph{Chart $(i,k)_u$:}
\label{sec:chart-i-k_u}

This last chart is obtained via $x_i = u_it_i$, $\sy = v_it_i$, giving the model
\[
(u_iv_i^it_i^{i+1} - 1) v_i^k t_i^{k-2} = u_i(u_i + 1).
\]
The central fiber is given by $t_0 = t_i^{i+1}v_i^i$. One checks that the special fiber when $k \geq 3$ consists of the components
\begin{itemize}
    \item $D_{i,k}: v_i = u_i = 0$ with multiplicity $i$;
    \item $E_{i,k}: v_i = u_i + 1 = 0$ with multiplicity $i$;
    \item $D_{i+1,k}: t_i = u_i = 0$ with multiplicity $i+1$; and
    \item $E_{i+1,k}: t_i = u_i + 1 = 0$ with multiplicity $i+1$.
\end{itemize}
As with the chart $(i,k)_b$, multiplicity $0$ components mean that such components are absent when $i = 0$.
The components $D_{i+1,k}$ and $D_{i,k}$ (when the latter exists) intersect transversally once at $(u_i, v_i, t_i) = (0,0,0)$, and the components $E_{i+1,k}$ and $E_{i,k}$ intersect transversally at $(-1,0,0)$. One checks that the latter intersection point is identical to the intersection point in chart $(i,k)_b$. There are no other intersections.

When $k = 2$, we get
\begin{itemize}
    \item $D_{i,2}: v_i = u_i = 0$ with multiplicity $i$;
    \item $E_{i,2}: v_i = u_i + 1 = 0$ with multiplicity $i$; and
    \item $G_{i+2,2}: t_i = u_i^2 + u_i + v_i^2 = 0$ with multiplicity $i+1$.
\end{itemize}
The component $G_{i+1,2}$ intersects each of $D_{i,2}, E_{i,2}$ once transversally. The intersection with $E_{i,2}$ is the same as in chart $(i,2)_b$.

When $k \geq 3$, the $u_i$-derivative shows that this chart is regular. When $k = 2$, the $u_i$-derivative is zero if and only if $u_i = -\frac12$. Substituting into the $v_i$-derivative shows that the chart is regular.


\subsubsection{Putting the charts together}
\label{sec:putt-charts-togeth}

We start with the chart $(0, r)$ and blow up, inductively obtaining charts of the form $(i, r-2i)$, $(i, r-2i)b$ and $(i, r-2i)u$. The procedure terminates upon reaching a chart of the form $(s, 1)$ or $(s, 0)$; thus we treat the cases of $r$ even and odd separately. Since $r$ is fixed, the value of $k$ for each case is a function of $i$. Therefore we will frequently leave off reference to $k$ in all subscripts. Notice that all components of the form $F_{\cdot}$ are glued together, and so we may leave off the subscript entirely. Lastly, the components $D_i$ and $E_i$ each have multiplicity $i$.

We first suppose that $r$ is odd. Let $s = \frac12(r-1)$. Then the resulting regular proper model consists of the 3-fold intersection of components $F$, $D_s$, and $E_s$ as in chart $(s, 1)$, plus two ``tails'': $D_s$ connected to $D_{s-1}$, which is then connected to $D_{s-2}, \dots$, terminating with $D_1$, and similarly $E_s$ connected to $E_{s-1}, \dots, E_1$. The associated reduced curve is not semi-stable, but one may consider the ``dual graph-like object'' in Figure~\ref{fig:superelliptic-dual-graph-odd}. In that figure, the $\ast$ denotes the triple intersection point of $F$, $D_{s}$, and $E_{s}$.
\begin{figure}[h]\centering
  \[
\xygraph{
  !{<0cm,0cm>;<1.5cm,0cm>:<0cm,1.25cm>::}
  !{(2,5.5) }*{F}
  !{(2,5) }*{\bullet}="f"
  !{(2,4) }*{\ast}="triple"
  !{(.5,3) }*{D_{s}}
  !{(1,3) }*{\bullet}="ds"
  !{(1,2.6) }*{}="dabove"
  !{(1,2.1) }*{\vdots}="dspace"
  !{(1,1.5) }*{}="dbelow"
  !{(1,1) }*{\bullet}="d2"
  !{(.5,1) }*{D_2}
  !{(1,0) }*{\bullet}="d1"
  !{(.5,0) }*{D_1}
  !{(3.5,3) }*{E_{s}}
  !{(3,3) }*{\bullet}="es"
  !{(3,2.6) }*{}="eabove"
  !{(3,2.1) }*{\vdots}="espace"
  !{(3,1.5) }*{}="ebelow"
  !{(3,1) }*{\bullet}="e2"
  !{(3.5,1) }*{E_2}
  !{(3,0) }*{\bullet}="e1"
  !{(3.5,0) }*{E_1}
  % !{(4,0) }*{\bullet}="e1"
  % !{(4,1) }*{\bullet}="e2"
  % !{(4,1.5) }*{}="ebelow"
  % !{(4,2.1) }*{\vdots}="espace"
  % !{(4,2.6) }*{}="eabove"
  % !{(4,3) }*{\bullet}="erm"
  % !{(4,4) }*{\bullet}="er"
  % !{(4.4,0) }*{E_1}
  % !{(4.4,1) }*{E_2}
  % !{(4.6,3) }*{E_{r-1}}
  % !{(3.6,4) }*{E_r}
  "f"-"triple"
  "triple"-"ds"
  "ds"-"dabove"
  "dbelow"-"d2"
  "d2"-"d1"
  "triple"-"es"
  "es"-"eabove"
  "ebelow"-"e2"
  "e2"-"e1"
}
\]
  \caption{Dual graph of $C_k$, $t=1$, $r$ odd}
\label{fig:superelliptic-dual-graph-odd}
\end{figure}

Now suppose $r$ is even. Let $s = \frac12 r$. Then we end up with $F$ connected to $G_s$ by 2 intersection points, and $G_s$ has 2 ``tails'' attached to it at distinct places: $D_{s-1}, \dots, D_1$ and $E_{s-1}, \dots, E_1$ respectively. In this case, the associated reduced curve is semi-stable, so that we may construct the dual graph in Figure~\ref{fig:superelliptic-dual-graph-even}.
\begin{figure}[h]\centering
\[
\xygraph{
  !{<0cm,0cm>;<1.5cm,0cm>:<0cm,1.25cm>::}
  !{(2,6) }*{F}
  !{(2,5.5) }*{\bullet}="f"
  !{(2,4) }*{\bullet}="g"
  !{(2.5,4) }*{G_s}
  !{(.5,3) }*{D_{s-1}}
  !{(1,3) }*{\bullet}="ds"
  !{(1,2.6) }*{}="dabove"
  !{(1,2.1) }*{\vdots}="dspace"
  !{(1,1.5) }*{}="dbelow"
  !{(1,1) }*{\bullet}="d2"
  !{(.5,1) }*{D_2}
  !{(1,0) }*{\bullet}="d1"
  !{(.5,0) }*{D_1}
  !{(3.5,3) }*{E_{s-1}}
  !{(3,3) }*{\bullet}="es"
  !{(3,2.6) }*{}="eabove"
  !{(3,2.1) }*{\vdots}="espace"
  !{(3,1.5) }*{}="ebelow"
  !{(3,1) }*{\bullet}="e2"
  !{(3.5,1) }*{E_2}
  !{(3,0) }*{\bullet}="e1"
  !{(3.5,0) }*{E_1}
  % !{(4,0) }*{\bullet}="e1"
  % !{(4,1) }*{\bullet}="e2"
  % !{(4,1.5) }*{}="ebelow"
  % !{(4,2.1) }*{\vdots}="espace"
  % !{(4,2.6) }*{}="eabove"
  % !{(4,3) }*{\bullet}="erm"
  % !{(4,4) }*{\bullet}="er"
  % !{(4.4,0) }*{E_1}
  % !{(4.4,1) }*{E_2}
  % !{(4.6,3) }*{E_{r-1}}
  % !{(3.6,4) }*{E_r}
  "f"-@/^0.5cm/"g"
  "f"-@/_0.5cm/"g"
  "g"-"ds"
  "ds"-"dabove"
  "dbelow"-"d2"
  "d2"-"d1"
  "g"-"es"
  "es"-"eabove"
  "ebelow"-"e2"
  "e2"-"e1"
}
\]
  \caption{Dual graph of $C_k$, $t=1$, $r$ even}
\label{fig:superelliptic-dual-graph-even}
\end{figure}

In both cases, one checks that the self-intersection number of each component is $-2$, except for $F$, which has $F^2 = -2s$. By Castelnuovo's criterion, the model is minimal. Our calculations above show that the model is regular. Therefore we have found the minimal proper regular model we were looking for.

\subsection{Component group}
\label{sec:component-group-t-equals-one}

We follow a similar procedure as when $t = \infty$ to compute the component group. 

\subsubsection{Case 1: $r$ odd}
\label{sec:case-1:-r-odd}

Recall that $r = 2s + 1$. Put the components of $C_k$ in the order $D_1, D_2, \dots, D_{s}, E_{s}, \dots, E_1, F$. With respect to this ordering, the intersection matrix is the $r \times r$ matrix
\[
A = \left[\begin{array}{rrrrrrrrr|rr}
  -2 & 1 & & & & & & & & \\
  1 & -2 & 1 & & & & & & & \\
  & 1 & -2 & 1 & & & & & & \\
  & & & & & \ddots & & & & 1 \\
  & & & & & & & & & 1 \\
  & & & & & & & & & \\
  & & & & & & & 1 & -2 & \\ \hline
  & & & & 1 & 1 & & & & -2s
\end{array}\right].
\]
The 1s in the right-hand column occur at rows $s$ and $s+1$, and similarly the 1s in the bottom row occur at columns $s$ and $s+1$.

\paragraph{Step 1:}
\label{sec:step-1-odd}

For $i = 1, \dots, 2s-1$ in turn, we do the following column operations:
\begin{itemize}
    \item Add twice column $i$ to column $i+1$.
    \item Subtract column $i$ from column $i+2$.
\end{itemize}
We then add twice column $2s-1$ to column $2s$. An easy induction shows that the resulting matrix is
\[
\left[\begin{array}{rrrrrrrr|r}
  -2 & -3 & & & \dots & & & -r & \\
  1 & & & & & & & & \\
  & 1 & & & & & & & \\
  & & & & \ddots & & & & 1 \\
  & & & &  & & & & 1 \\
  & & & &  & & & & \\
  & & & & & & 1 & 0 & \\ \hline
  & & & & 1 & 3 & \dots & r & -2s
\end{array}\right].
\]
The nonzero entries in the bottom row are the consecutive odd numbers from 1 to $r$.

\paragraph{Step 2:}
\label{sec:step-2-odd}

Zero out the first $r-2$ entries of the top and bottom rows:
\[
\left[\begin{array}{rrrrrrrr|r}
  0 & 0 & & & \dots & & & -r & r \\
  1 & & & & & & & & \\
  & 1 & & & & & & & \\
  & & & & \ddots & & & & 1 \\
  & & & &  & & & & 1 \\
  & & & &  & & & & \\
  & & & & & & 1 & 0 & \\ \hline
  & & & & 0 & 0 & \dots & r & -r
\end{array}\right].
\]

\paragraph{Step 3:}
\label{sec:step-3-odd}

Eliminate the 1s in the last column and swap rows and columns to obtain
\[
\left[\begin{array}{c|rr}
  I & & \\ \hline
 & -r & r \\
& r & -r
\end{array}\right]
\]
where $I$ is the $(r-2) \times (r-2)$ identity matrix. From this we conclude that the component group is $\Phi \isom \dfrac{\Z}{r\Z}$.

\subsubsection{Case 2: $r$ even}
\label{sec:case-2:-r-even}

Recall that $r = 2s$. Put the components of $C_k$ in the order $D_1, D_2, \dots, D_{s-1}, G_s, E_{s-1}, \dots, E_1, F$. With respect to this ordering, the intersection matrix is the $r \times r$ matrix
\[
A = \left[\begin{array}{rrrrrrrr|r}
  -2 & 1 & & & & & & & \\
  1 & -2 & 1 & & & & & & \\
  & 1 & -2 & 1 & & & & & \\
  & & & & & & & & \\
  & & & & \ddots & & & & 2 \\
  & & & & & & & & \\
  & & & & & & 1 & -2 & \\ \hline
  & & & & 2 &  & & & -r
\end{array}\right].
\]
The 2 in the right-hand column occurs at row $s$, and similarly the 2 on the bottom row is at column $s$.

\paragraph{Step 1:}
\label{sec:step-1-even}

For $i = 1, \dots, 2s-2$ in turn, we do the following column operations:
\begin{itemize}
    \item Add twice column $i$ to column $i+1$.
    \item Subtract column $i$ from column $i+2$.
\end{itemize}
We then add twice column $2s-2$ to column $2s-1$. An easy induction shows that the resulting matrix is
\[
\left[\begin{array}{rrrrrrrr|r}
  -2 & -3 & & & \dots & & & -r & \\
  1 & & & & & & & & \\
  & 1 & & & & & & & \\
  & & & & \ddots & & & & 2 \\
  & & & & & & 1 & 0 & \\ \hline
  & & & & 2 & 4 & \dots & r & -r
\end{array}\right].
\]
The 2 in the last column is in row $s$, and the 2 in the last row occurs in column $s$.

\paragraph{Step 2:}
\label{sec:step-2-even}

Zero out the first $r-2$ entries of the top and bottom rows:
\[
\left[\begin{array}{rrrrrrrr|r}
  0 & 0 & & & \dots & & & -r & r \\
  1 & & & & & & & & \\
  & 1 & & & & & & & \\
  & & & & \ddots & & & & 2 \\
  & & & & & & 1 & 0 & \\ \hline
  & & & & 0 & 0 & \dots & r & -r
\end{array}\right].
\]

\paragraph{Step 3:}
\label{sec:step-3-even}

Eliminate the 2 in the last column and swap rows and columns to obtain
\[
\left[\begin{array}{c|rr}
  I & & \\ \hline
 & -r & r \\
& r & -r
\end{array}\right]
\]
where $I$ is the $(r-2) \times (r-2)$ identity matrix. Thus in this case the component group is $\Phi \isom \dfrac{\Z}{r\Z}$ as well.

Therefore we have
\begin{theorem}
  Let $C$ be the complete nonsingular curve birational to the affine curve with equation $\caff:x\sy^r = (x+1)(x+t)$ over $K$, with $r \geq 3$. Let $\scd$ be the minimal proper regular model for $C$ at $t = 1$. Let $J$ be the Jacobian for $C$. Then the component group for the N\'eron model of $J$ at $t = 1$ is isomorphic to
  $
  \frac{\Z}{r\Z}.
  $
\end{theorem}

\subsection{Ramified extension of degree $r$}
\label{sec:ramif-extens-degr}

We now consider the base extension of our curve to the field $k(u_0)$ where $u_0^r = t_0$. Our equation is then $(x_0 - 1)\sy^r = x_0(x_0 + u_0^r)$. The corresponding arithmetic surface is birational to the surface with equation $(x_0'u_0^r - 1)\sy'^r = x_0'(x_0' + 1)$ via $\sy = u_0^2 \sy'$ and $x_0' = u_0^r x_0$. The latter surface has smooth reduction at $u_0 = 0$. If $d$ is an integer with $r \mid d$, then after base change to $k(u_0')$ where $u_0'^d = t_0$, our curve again has a model over $u_0 = 0$ with smooth reduction; this holds because good reduction is stable under ramified base change. 

\section{Height pairing}
\label{sec:height-pairing}

In this section, we compute the height pairing on various sections of our curve. Specifically, we will compute $\langle P_{ij} - Q_\infty, P_{i' j'} - Q_\infty \rangle$. By bilinearity, it suffices to compute $\langle P_{ij} - Q_\infty, P_{00} - Q_\infty \rangle$ for all $i,j$. In all of the following, we base-extend to the field $K(u)$ where $u^d = t$.

\subsection{Basic theory}
\label{sec:basic-theory}

Let $P, P', Q$ be three distinct points on our curve; we will later set $P = P_{ij}$, $P' = P_{00}$, and $Q = Q_\infty$. Then
\[
\langle P - Q, P' - Q\rangle = -P \cdot P' + P \cdot Q + P' \cdot Q - Q^2 + D_P \cdot P',
\]
 where $D_P$ is a fibral divisor such that $D_P \cdot Q = 0$ and, for every fibral divisor $D$, $D_P \cdot D = (Q - P) \cdot D$. Since $D_P$ is fibral, the calculation of $D_P \cdot P'$ will be done at each fiber. On each fiber with only a single component (notably smooth fibers), we see that $D_P$ has empty support; thus we can restrict ourselves to the bad fibers of our arithmetic surface to calculate $D_P \cdot P'$. 

We must also compute $P \cdot P'$, $P \cdot Q$, $P' \cdot Q$, and $Q^2$. The former three can be computed on each bad fiber separately. It will turn out that these intersection numbers are 0 on every fiber except $u = -1$. We will compute $Q^2$ in \S~tbd by computing the degree of a certain invertible sheaf.


\subsection{Auxiliary results}
\label{sec:auxiliary-results}

The following results will help us compute the various intersection numbers. Let us suppose we restrict ourselves to a special fiber with components $C_0, C_1, \dots, C_n$.

\begin{proposition}\label{prop:dp-dot-p-cofactor}
  Suppose $Q$ intersects $C_0$, $P$ intersects $C_i$, and $P'$ intersects $C_j$, with $i,j \neq 0$. Let $A$ be the intersection matrix for the fiber, and let $B$ be the matrix obtained by deleting the first row and column from $A$. Let $\beta_{ij}$ be the $ij$ cofactor for $B$. Let $\delta$ be the multiplicity of $C_0$ in the special fiber. Finally, let $\phi$ be the order of the component group of the Jacobian of $C$. Then
  \[
  D_P \cdot P' = (-1)^{n+1} \frac{\beta_{ij}}{\delta^2 \phi}.
  \]
\end{proposition}

\begin{proof}
  Recall that we choose $D_P = \sum d_h C_h$ so that $d_0 = 0$ and $D_P \cdot C_h = (Q - P) \cdot C_h$ for every $h > 1$. If we let $\vd = (d_1, \dots, d_n)$, then this is equivalent to saying
  \[
  B\vd = -\ve_i
  \]
  where $\ve_i$ is the $i$th standard basis vector. The intersection form $A$ has the property that every $n \times n$ submatrix is nonsingular, so we have
  \[
  \vd = -B^{-1}\ve_i.
  \]
  The intersection number $P' \cdot D_P$ is simply the coefficient $d_j$, and
  \[
  D_P \cdot P' = d_j = \ve_j^T \vd = -\ve_j^TB^{-1}\ve_i.
  \]
  By symmetry of $A$, and hence of $B$, and the cofactor formula for the inverse of a matrix, we have
  \[
  D_P \cdot P' = - \frac{\beta_{ij}}{\det B}.
  \]
  But according to Corollary~1.3 in~\cite{lorenzini},
  \[
  \det (-B) = \delta^2 \phi.
  \]
  The claim now follows.
\end{proof}

\begin{proposition}\label{prop:am-defn-det}
  Let $A_m$ be the $m \times m$ matrix whose entries are given by
  \[
  a_{ij} = \begin{cases}
    -2 & \text{if } i = j \\
    1 & \text{if } |i - j| = 1\\
    0 & \text{otherwise}
  \end{cases}.
  \]
  Then $\det A_m = (-1)^m (m+1)$.
\end{proposition}

\begin{proof}
  Consider an elliptic curve over a discrete valuation ring with type $I_{m+1}$ reduction. Let $A$ be the intersection matrix for the special fiber, where the components are ordered in the usual manner. One observes that $A_m$ is the $m \times m$ submatrix obtained from $A$ by deleting the first row and column. By \cite[Corollary~1.3]{lorenzini}, $\det A_m = (-1)^m \phi$, where $\phi$ is the order of the component group of our elliptic curve. But as our curve has type $I_{m+1}$ reduction, the component group is $\Z/(m+1)\Z$.
\end{proof}

\begin{proposition}\label{prop:fg-equals-u-blow-up}
  Let $R$ be a discrete valuation ring with maximal ideal $(u)$. Suppose $C$ is given locally by $fg = u^d$, where $d \geq 3$. Let $P$ be a point on $C$ such that $f(P), g(P) \in (u)$. Let $C_1$ and $C_2$ be the components of the special fiber of $C$ given by $f = u = 0$ and $g = u = 0$ respectively, and suppose these components cross transversally. Let the minimal proper regular model of $C$ have special fiber given by the chain of rational curves $C_1, E_1, \dots, E_{d-1}, C_2$.
  \begin{enumerate}
      \item  If
  \[
  \frac{g(P)}{u}, \frac{g(P)}{f(P)}, f(P) \in (u) \text{ and } \frac{f(P)}{u} \in R^\times
  \]
  then $P$ lies on the smooth locus of $E_{d-1}$.
    \item $\frac{f}{u}$ is a degree 1 parameter for $E_{d-1}$.
  \end{enumerate}
\end{proposition}

\begin{proof}
  After doing a single blow-up, one has the chain of rational curves $C_1, E_1, E_{d-1}, C_2$. The result follows from checking each chart.
\end{proof}

\subsection{Pairing at $u = 0$}
\label{sec:pairing-at-u}

We compute the pairing at $u = 0$. From Proposition~\ref{prop:dp-dot-p-cofactor}, we must determine which components each of the $P_{i,j}$ and $Q_\infty$ lie on. We first recall that the special fiber consists of rational curves connected by $r$ chains of $\Pro^1$'s, each of length $d-1$. Equivalently, the dual graph is given in Figure~\ref{fig:u-equals-zero}.
\begin{figure}[h]\centering
  \[
\xygraph{
  !{<0cm,0cm>;<1.5cm,0cm>:<0cm,1.25cm>::}
  !{(0, 2) }*{\bullet}="c0"
  !{(5, 2) }*{\bullet}="clast"
  !{(1, 4) }*{\bullet}="c11"
  !{(2, 4) }*{\bullet}="c12"
  !{(3, 4) }*{\dots}="c1dots"
  !{(4, 4) }*{\bullet}="c1last"
  !{(1, 3) }*{\bullet}="c21"
  !{(2, 3) }*{\bullet}="c22"
  !{(3, 3) }*{\dots}="c2dots"
  !{(4, 3) }*{\bullet}="c2last"
  !{(2.5, 2) }*{\vdots}
  !{(1, 1) }*{\bullet}="cr1"
  !{(2, 1) }*{\bullet}="cr2"
  !{(3, 1) }*{\dots}="crdots"
  !{(4, 1) }*{\bullet}="crlast"
  "c0"-"c11"
  "c11"-"c12"
  "c12"-"c1dots"
  "c1dots"-"c1last"
  "c1last"-"clast"
  "c0"-"c21"
  "c21"-"c22"
  "c22"-"c2dots"
  "c2dots"-"c2last"
  "c2last"-"clast"
  "c0"-"cr1"
  "cr1"-"cr2"
  "cr2"-"crdots"
  "crdots"-"crlast"
  "crlast"-"clast"
}
\]
  \caption{Dual graph of $C_k$, $u=0$}
\label{fig:u-equals-zero}
\end{figure}
There are $r$ paths from the left hand vertex to the right hand vertex, and on each path, there are $d-1$ intermediate vertices, for a total of $r(d-1) + 2$ vertices in the graph. We label the corresponding components of the fiber as follows. Before desingularizing, the special fiber is given by $x(y^r - x - 1) = u^d$. The component $x = u = 0$ corresponds to the left-most vertex, and we call it $C_0$. The component $y^r - x - 1 = u = 0$ corresponds to the the right-most vertex, which we label $C_{r(d-1)+1}$. Each horizontal path corresponds to a $\lfloor \frac{d}{2}\rfloor$-fold blow-up of one of the nodes; these nodes are given by $x = 0$, $y = \omega^j$ where $\omega$ is the primitive $r$th root of unity given by $\omega = \zeta^{d/r}$. Label each of the horizontal components as $C_{j(d-1) + i}$, where $0 \leq j \leq r-1$, $1 \leq i \leq d-1$, $j$ increases from top to bottom, and $i$ increases from left to right. Thus if the top horizontal path corresponds to the blow-up of the node $x = 0, y = 1$, then the top left component would be $C_1$, and $C_2$ would be immediately to the right of it.

\begin{proposition}
  The section $Q_\infty$ lies on $C_0$. The section $P_{ij}$ lies on $C_{(j+1)(d-1)}$.
\end{proposition}

Note that $C_{(j+1)(d-1)} = C_{j(d-1) + d-1}$ is the right-most vertex on the $j$th horizontal path.

\begin{proof}
  Let $\XX_0$ be the affine curve given by $x_0 y_0^r = (x_0+1)(x_0+u^d)$; it is an affine model for $C$. The special fiber, as noted above, consists of two rational curves meeting at $r$ points. One sees that $Q_\infty$ does not lie above any of these nodes. Therefore the specialization of $Q_\infty$ to the fiber over $u = 0$ lies on the smooth locus of one of the components $C_0$ or $C_{r(d-1)+1}$. We observe that $\XX_0$ glues to $\XX_2$ via
  \[
  (x_0, y_0) = (w, w/z). % Wrong
  \]
  Since $Q_\infty$ is given by $(w, z) = (0, 0)$, one sees that $x_0(Q_\infty) = 0$. Therefore $Q_\infty$ lies on $C_0$.

  Now consider $P_{ij}$. The chart $\XX_0$ glues to $C$ via $(x_0, y_0) = (x, y/x)$. Therefore
  \[
  (x_0(P_{ij}), y_0(P_{ij})) = (\zeta^i u, \omega^j(\zeta^iu + 1)^{d/r}).
  \]
  The specialization of $P_{ij}$ lies on the node with coordinates $(x_0, y_0, u) = (0, \omega^j, 0)$. Thus we need to blow up $\XX_0$ to determine which component $P_{ij}$ lies on. We at least know that $P_{ij}$ must lie on $C_0$, $C_{r(d-1)+1}$ or $C_{j(d-1) + k}$ for some $k$. Let $f = \frac{x_0}{1+x_0}$ and $g = y_0^r - x_0 - 1$. We have
  \[
  f(P_{ij}) = \frac{\zeta^i u}{1 + \zeta^i u} \quad g(P_{ij}) = u^d + \zeta^{i(d-1)} u^{d-1}.
  \]
  One checks that the hypotheses of Proposition~\ref{prop:fg-equals-u-blow-up} hold, whence $P_{ij}$ lies on $C_{(j+1)(d-1)}$.
\end{proof}

\begin{proposition}\label{prop:local-intersections-u-0}
  The intersection numbers $P_{00} \cdot P_{ij}$ for $ij \neq 00$ and $Q_{\infty} \cdot P_{ij}$ at $u = 0$ are all zero.
\end{proposition}

\begin{proof}
  In the pairing $Q_\infty \cdot P_{ij}$, and in $P_{00} \cdot P_{ij}$ when $j \neq 0$, the points do not even lie on the same component of the special fiber. Suppose in the latter pairing that $j = 0$, so that both points reduce to $C_{d-1}$. By Proposition~\ref{prop:fg-equals-u-blow-up}, $\frac{x_0}{u}$ is a coordinate function for $C_{d-1}$. But
  \[
  \frac{x_0(P_{00})}{u} = 1 = \zeta^i = \frac{x_0(P_{i0})}{u}
  \]
  if and only if $i = 0$.
\end{proof}

Recall that the matrix $B$ constructed in \S~\ref{sec:auxiliary-results} is obtained by deleting the first row and column from the intersection matrix for the special fiber. Using the ordering given above for the components, we get
\[
B =
\left[\begin{array}{ccccc}
  A_{d-1} & & & & e_{d-1} \\
  & A_{d-1} & & & e_{d-1} \\
  & & \ddots & & \vdots \\
  & & & A_{d-1} & e_{d-1} \\
  e_{d-1}^T & e_{d-1}^T & \cdots & e_{d-1}^T & -r
\end{array}\right]
\]
The above gives $B$ in block form. The $A_{d-1}$ are as given in Proposition~\ref{prop:am-defn-det}, and $e_{d-1} \in \R^{d-1}$ is the $(d-1)$st standard basis vector, written as a column (so $e_{d-1}^T$ is a row vector). There are $r$ copies of $A_{d-1}$ in the matrix, so that $B$ has size $r(d-1) + 1$.

Let
\[
M_{\ell} =
\left[\begin{array}{ccccc}
  1 & 2 & 3 & \cdots & \ell \\
  2 & 4 & 6 & \cdots & 2\ell \\
  \vdots &\vdots & \vdots & & \vdots \\
  \ell & 2\ell & 3\ell & \cdots & \ell^2 
\end{array}\right]
\]

and let $N_{s,t}$ be the $t \times t$ symmetric matrix given by
\[
N_{ij} = \begin{cases}
    i(t+(t-j+1)(s-1)) & \text{if } i \geq j \\
    N_{ji} & \text{if } i < j
  \end{cases},
\]
for $1 \leq i,j \leq t$.


\begin{proposition}
Let $v_{\ell} = (1,2,\ldots, \ell)^T$. Then the matrix
\[
X = \frac{d^{r-2}}{\det(-B)} \cdot
\left[\begin{array}{cccccc}
  N_{r,d-1} & M_{d-1} & M_{d-1} & \cdots & M_{d-1} & dv_{d-1} \\
  M_{d-1} & N_{r,d-1} & M_{d-1} & \cdots & M_{d-1} & dv_{d-1} \\
  \vdots &\vdots & \vdots & & & \vdots \\
  M_{d-1} & M_{d-1} & M_{d-1} & \cdots &N_{r,d-1} & dv_{d-1}\\
  dv_{d-1}^T & dv_{d-1}^T & dv_{d-1}^T & \cdots & dv_{d-1}^T &d^2 \\
   
\end{array}\right]
\]
is the inverse of the matrix $B$ defined above.
\end{proposition}
\begin{proof}
This is just algebra that can be checked by hand.
\end{proof}

\begin{proposition}
The $(d-1, (j+1)(d-1))$th entry of $B^{-1}$ is given by the equation
\[
(B^{-1})_{d-1,(j+1)(d-1)} = \frac{d^{r-2}}{\det(-B)} \cdot \begin{cases}
    d^2r-2dr-d+r+1 & \text{if } j=0 \\
    (d-1)^2 & \text{otherwise }
  \end{cases}.
\]
\end{proposition}

\subsection{Pairing at $u=\infty$}
\label{sec:pairing-at-u=infty}

Recall that the fiber at $u=\infty$ is birational to that at $u=0$. Therefore the special fibers and intersection matrices are identical. We must now determine which component our sections lie on.
\begin{proposition}
  On the fiber at $u=\infty$, $Q_\infty$ lies on $C_0$ and $P_{ij}$ lies on $C_{(i+j)(d-1) +1}$, where $i+j$ is taken modulo $r$.
\end{proposition}

\begin{proof}
  Let $\sxi$ be the affine curve
  \[
  x_\infty y_\infty^r = (x_\infty + 1)(x_\infty + {U^d})
  \]
  where $U = \frac{1}{u}$. The chart $\sxi$ glues to $\XX_0$ and $\XX_2$ via 
  \[
  (x_\infty, y_\infty) = (U^d x_0, U^{d/r} y_0) = \bigg(U^d w, U^{d/r} \frac{w}{z}\bigg).
  \]
  We are concerned with the fiber when $U = 0$. Let $C_0$ be the component given by $x_\infty = U = 0$, and $C_{r(d-1)+1}$ the component given by $y_\infty^r - x_\infty - 1 = U = 0$; label the remaining components of the special fiber of the minimal proper regular model similarly as in \S~\ref{sec:pairing-at-u}. One sees immediately that on the special fiber, $Q_\infty$ lies on the component $C_0$.

  Next, observe that $\sxi$ glues to $C$ via
  \[
  (x_\infty, y_\infty) = (U^d x, U^{d/r} y/x).
  \]
  Thus
  \[
  (x_\infty(P_{ij}), y_\infty(P_{ij})) = (\zeta^i U^{d-1}, \omega^j (\zeta^i + U)^{d/r}).
  \]
  Modulo $U$, this gives $(0,\omega^{i+j})$; that is, $P_{ij}$ lies on the corresponding node of the special fiber. Let $f = y_\infty^r - x_\infty - 1$ and $g = x_\infty$. We see that 
  \[
  f(P_{ij}) = \zeta^{i(d-1)} U + U^d \quad g(P_{ij}) = \zeta^i U^{d-1}.
  \]
  One now verifies the hypotheses of Proposition~\ref{prop:fg-equals-u-blow-up} to conclude that $P_{ij}$ lies on $C_{(i+j)(d-1) +1}$, where in the subscript $i+j$ is taken modulo $r$.
\end{proof}

\begin{proposition}\label{prop:local-intersections-u-infty}
  The intersection numbers $P_{00} \cdot P_{ij}$ for $ij \neq 00$ and $Q_{\infty} \cdot P_{ij}$ at $u = \infty$ are all zero.
\end{proposition}

\begin{proof}
  The reasoning is similar to that of Proposition~\ref{prop:local-intersections-u-0}. The only nontrivial case occurs when $i+j \equiv 0 \pmod{r}$, in which case both $P_{00}$ and $P_{ij}$ lie on $C_1$. By Proposition~\ref{prop:fg-equals-u-blow-up}, $\dfrac{y_\infty^r - x_\infty - 1}{U}$ is a coordinate function for $C_1$. Evaluating this function at $P_{00}$ and $P_{ij}$ gives the values $1$ and $\zeta^{i(d-1)}$ respectively. These are equal if and only if $i = 0$, from which $j = 0$ as well.
\end{proof}

\subsection{Pairing at $u = \zeta^k$}
\label{sec:pairing-at-u-1}

Fix $0 \leq k \leq d-1$. Since the extension $K(u)$ is unramified over $t = 1$, the special fiber at $u = \zeta^k$ is isomorphic to that of $C/K$ when $t = 1$. Recall the initial chart 
\[
\caff: (x_0 - 1) \bar{y}^r = x_0(x_0 + (u^d - 1)),
\]
where $\caff$ glues to $\XX_1$ via $x_0 = x + 1$ and $\bar{y} = y/x$. Let $u_k = u - \zeta^k$ and $\alpha_k = \frac{u^d - 1}{u_k}$. Then we can rewrite this model in a neighborhood of $u_k = 0$ as
\[
(x_0 - 1) \bar{y}^r = x_0(x_0 + \alpha_ku_k).
\]
The special fiber of $\caff$ has a single component, $F$, with multiplicity 1 and a single node at $(x_0, \bar{y}, u_k) = (0,0,0)$.
\begin{proposition}\label{prop:points-on-components-u-zeta-k}
  At $u=\zeta^k$, $Q_\infty$ lies on $F$. If $i+k \not\equiv \frac{d}{2} \pmod{d}$, then $P_{ij}$ lies on $F$. If $i + k \equiv \frac{d}{2} \pmod{d}$, then $P_{ij}$ lies on $E_1$.
\end{proposition}

\begin{proof}
  We immediately see that $Q_\infty$ does not reduce to the node of $F$, so $Q_\infty$ lies on the smooth locus of (the proper curve with affine piece) $F$. For $P_{ij}$, we observe that
  \[
  (x_0, \bar{y})(P_{ij}) = (\zeta^i u + 1, \omega^j (\zeta^i u + 1)^{d/r}).
  \]
  The reduction of this point has coordinates
  \begin{equation}
    (\zeta^{i+k} + 1, \omega^j(\zeta^{i+k} + 1)^{d/r})\label{eq:pij-on-u-equals-zeta-k}
  \end{equation}
    which lies on the node if and only if $\zeta^{i+k} = -1$. This occurs precisely when $i + k \equiv \frac{d}{2} \pmod{d}$.

  Now suppose that $\zeta^{i+k} = -1$. We consider the chart $(0,r)_b$ from section \S~???. This latter chart was given by coordinates $x_0, b_0, \tau_0$, where $t_0 = x_0 \tau_0$. In our case, $x_0$ and $b_0$ are the same, but our third coordinate, which we call $\mu_k$, is given by $u_k = x_0 \mu_k$, yielding the chart
  \[
  (x_0 - 1)x_0^{r-2}b_0^r = 1 + \alpha_k \mu_k.
  \]
  The special fiber has components $F$ given by $\mu_k = (x_0 - 1)x_0^{r-2}b_0^r - 1 = 0$ and $E_1$ given by $x_0 = 1 + \alpha_k \mu_k = 0$. Furthermore, this piece of the special fiber is smooth. We have
  \[
  (x_0, b_0, \mu_k)(P) = (\zeta^iu + 1, \omega^j(\zeta^i u + 1)^{\frac{d}{r} - 1}, -\zeta^k).
  \]
  If $d = r$, on the special fiber we obtain the point $(0, \omega^j, -\zeta^k)$. If $d > r$, we obtain $(0, 0, -\zeta^k)$. In both cases, $P_{ij}$ lies on the smooth locus of $E_1$.
\end{proof}

The intersection form $A$ when $u = \zeta^k$ is given in either \S~\ref{sec:case-1:-r-odd} or \S~\ref{sec:case-2:-r-even}. In both cases, the component $F$ corresponds to the last row and last column of $A$. As the matrix $B$ of Proposition~\ref{prop:dp-dot-p-cofactor} is obtained by removing this row and column, one observes that $B = A_{r-1}$, where $A_{r-1}$ is defined in Proposition~\ref{prop:am-defn-det}.

\begin{proposition}\label{prop:dp-u-zeta-k}
  Let $P = P_{00}$ and $P' = P_{ij}$ with $P \neq P'$. If $k \neq \frac{d}{2}$ or $i \neq 0$, then $D_P \cdot P' = 0$. If $k = \frac{d}{2}$ and $i = 0$, then $D_P \cdot P' = \frac{r-1}{r}$.
\end{proposition}

\begin{proof}
  If $k \neq \frac{d}{2}$, then we may take $D_P = 0$, as $P$ and $Q_\infty$ both lie on the same component, namely $F$. Now suppose that $k = \frac{d}{2}$. Recall that $D_P$ was chosen so that $F$ does not lie in its support. Thus $D_P \cdot P' = 0$ if $P'$ lies in $F$; this occurs whenever $i > 0$. We now consider the case when $k = \frac{d}{2}$ and $i = 0$. We will apply Proposition~\ref{prop:dp-dot-p-cofactor}. The component $C_0$ in that Proposition is $F$, which has multiplicity $\delta = 1$. The component group was shown in \S~\ref{sec:component-group-t-equals-one} to have order $\phi = r$. It remains to compute the appropriate cofactor. One checks that it suffices to compute the $(1,1)$ cofactor of the matrix $B$ described above. But this cofactor is precisely the determinant of $A_{r-2}$, which by Proposition~\ref{prop:am-defn-det}, equals $\pm(r-1)$. The claim follows from Proposition~\ref{prop:dp-dot-p-cofactor}.
\end{proof}

\begin{proposition}\label{prop:local-intersections-u-zeta-k}
  If $k \neq \frac{d}{2}$, then the intersection numbers $P_{00} \cdot P_{ij}$ for $ij \neq 00$ and $Q_{\infty} \cdot P_{ij}$ at $u = \zeta^k$ are all zero.
\end{proposition} 

\begin{proof}
  The only unclear case occurs for $P_{00} \cdot P_{ij}$ when $i + k \not\equiv \frac{d}{2} \pmod{d}$. In this case, \eqref{eq:pij-on-u-equals-zeta-k} gives the coordinates for both points on the special fiber, and one sees that the intersection number is zero.
\end{proof}

\begin{proposition}\label{prop:local-intersections-u-minus-1}
  If $k = \frac{d}{2}$, the intersection numbers $P_{00} \cdot P_{ij}$ for $i \neq 0$ and $Q_{\infty} \cdot P_{ij}$ at $u = -1$ are all zero. The intersection numbers $P_{00} \cdot P_{0j}$ for $j > 0$ are $\frac{d}{r} - 1$.
\end{proposition}

\begin{proof}
  The case with $Q_\infty$ is clear. The hypothesis $u = -1$ is identical to $k = \frac{d}{2}$, so that by Proposition~\ref{prop:points-on-components-u-zeta-k}, $P_{ij}$ lies on the component $F$ if and only if $i = 0$. The case $i \neq 0$ follows. We now suppose that $i = 0$ and $j > 0$. Let $R$ be the localization of
  \[
  \frac{K[x_0,b_0,\mu]}{(x_0 - 1)x_0^{r-2}b_0^r - 1 - \alpha \mu}
  \]
  at the ideal $(x_0, b_0, \mu - 1)$. Note that this is the adjusted chart $(0,r)_b$ mentioned in the proof of Proposition~\ref{prop:points-on-components-u-zeta-k} via $k = \frac{d}{2}$, $\alpha = \alpha_k$, and $\mu = \mu_k = \frac{u+1}{x_0}$. A local function for $P_{0j}$ in a neighborhood of the closed point of $R$ is given by
  \[
  f_j = b_0 - \omega^j x_0^{\frac{d}{r} - 1}.
  \]
  Then the intersection multiplicity $P_{00} \cdot P_{0j}$ is the length of 
  \[
  \frac{R}{(f_0, f_j)}.
  \]
  One checks that the latter ring is isomorphic to
  \[
  \frac{R}{\bigg(x_0^{\frac{d}{r} - 1}, b_0, \mu - 1\bigg)}
  \]
  from which the claim follows.
\end{proof}


\section*{The below 3 sections are a draft from Doug, with notes from him at the top}
%Doug

[As usual, we conflate a point $P_{ij}$ and the class of
$P_{ij}-Q_\infty$ in the Jacobian.  It might be better to write
something like $\overline P_{ij}$ for the latter.]

[Dependencies: In the first section below we will use (i) the height
calculation, i.e., the values of the pairing $\langle
P_{ij},P_{00}\rangle$; (ii) that certain divisors generate a subgroup
of $J$ of order $r^3$.  In the second we will use (iii) that
$J_r(K_d)$ has no $p$-torsion; (iv) the orders of component groups at
bad places; and (v) an upper bound on the rank of $J_r(K_d)$.  See
Lemma~\ref{lemma:missing} below for a statement of (ii), which is not
yet proven for $r$ even.]


\section{Structure of the visible subgroup}
Let $V=V_{r,d}$ be the subgroup of $J_r(K_d)$ generated by $P_{ij}$
for $i=0,\dots,d-1$ and $j=0,\dots,r-1$.  The goal of this section is
to compute the structure of $V$ as a group and as a module over
a certain group ring, and to compute the determinant of the height
pairing on $V/tor$.

\subsection{$V$ as an $R$-module}
Let $R$ be the integral group ring of $\mu_d\times\mu_r$, i.e., let
$$R=\frac{\Z[\sigma,\tau]}{(\sigma^d-1,\tau^r-1)}.$$

There is a natural action of $R$ on $V$ given by 
$$\sigma^i\tau^j(P_{ab})=P_{a+i,b+j}.$$
It is evident that $V$ is a cyclic $R$ module generated by $P_{00}$.
In other words, we have a surjective homomorphism of $R$-modules
\begin{align*}
R&\to V\\
\sum_{ij}a_{ij}\sigma^i\tau^j&\mapsto
\sum_{ij}a_{ij}\sigma^i\tau^j(P_{00})
=\sum_{ij}a_{ij} P_{ij}
\end{align*}


\subsection{Relations}
Considering the divisors of $x$, $x+1$, and $x+t$ shows that the
divisors $Q_0-Q_\infty$, $Q_1-Q_\infty$ and $Q_t-Q_\infty$ are
$r$-torsion.  Considering the divisor of $y$ shows that $Q_t-Q_\infty$ is in
the subgroup generated by $Q_0-Q_\infty$ and $Q_1-Q_\infty$.  

Consider the functions $x-\zeta^iu$, 
$$f_j=\zeta^{-jd/r}y-x(x+1)^{d/r}$$
and 
$$g_j=\zeta^{-jd/r}yx^{d/r-1}-u^{d/r}(x+1)^{d/r}.$$
Calculating as in [Legendre, Prop 3.2], we find that
$$\dvsr(x-\zeta^iu)=\sum_j P_{ij}-rQ_\infty,$$
$$\dvsr(f_j)=\sum_iP_{i,j}+(r-1)Q_0+Q_1-(r+d)Q_\infty$$
and
$$div(g_j)=\sum_iP_{i,-i+j}+Q_1-(d+1)Q_\infty.$$

Considering the divisor of $g_j$ (for any $j$) shows that $Q_1$ is in
$V$, and then considering the divisor of $f_j$ (for any $j$) shows
that $Q_0$ is also in $V$.  (Here we use that $Q_0$ has order $r$.)  
Thus $V$ contains the class of every degree zero divisor we have
seen.

Now for $1\le j\le r-1$ we set
$$D_j=\dvsr(f_j/f_{j-1})=\sum_i P_{i,j}-P_{i,j-1}$$
and
$$E_j=\dvsr(g_j/g_{j-1})=\sum_i P_{i,j-i}-P_{i,j-1-i},$$
and for $0\le i\le d-1$ we set
$$F_i=\dvsr(x-\zeta^iu)=\sum_j P_{ij}-rQ_\infty.$$
These divisors are zero in the Jacobian $J_r(K_d)$.  (Here and below
we read the indices $i$ modulo $d$ and $j$ modulo $r$.)

Restated in terms of the module homomorphism $R\to V$, we see that the
elements 
$$d_j=\sum_i \sigma^i\tau^j-\sigma^i\tau^{j-1}
=(\tau^j-\tau^{j-1})\sum_i \sigma^i,$$
$$e_j=\sum_i \sigma^i\tau^{j+d-i}-\sigma^i\tau^{j-1+d-i}=
( \tau^{j}-\tau^{j-1})\sum_i\sigma^i\tau^{d-i},$$
and
$$f_i=\sum_j \sigma^i\tau^j=\sigma^i\sum_j\tau^j$$
map to zero in $V$.

Let $I$ be the ideal of $R$ generated by
$$(\tau-1)\sum_i \sigma^i,\qquad
(\tau-1)\sum_i\sigma^i\tau^{d-i}, \quad\text{and}\quad \sum_j\tau^j.$$
Then it is easy to see that $d_j$, $e_j$, and $f_i$ all lie in $I$,
they generate it as an ideal, and in fact they form a basis of $I$ as
a $\Z$-module.

Thus we have a surjection of $R$-modules $R/I\to V$.  We will
eventually show that this is in fact an isomorphism.

Note that $R$ has rank $rd$ as a $\Z$-module, so the rank of $R/I$ as
a $\Z$-module is $rd-d-2(r-1)=(r-1)(d-2)$.  Thus the rank of $V$ is at
most $(r-1)(d-2)$.  

\subsection{$R/I$ as a group}
We just saw that $I$ is a free $\Z$-module of rank $d+2(r-1)$, so
$R/I$ has rank $(r-1)(d-2)$.  With more work we can compute the torsion
subgroup of $R/I$.

\begin{prop}\label{prop:R/I-as-group}
We have an isomorphism of $\Z$-modules $R/I\cong \Z^{(r-1)(d-2)}\oplus
T$ where
$$T=\begin{cases}
(\Z/r\Z)^3&\text{if $r$ is odd}\\
\Z/(r/2)\Z\oplus\Z/r\Z\oplus\Z/(2r)\Z&\text{if $r$ is even.}
\end{cases}$$
Thus the torsion subgroup of $R/I$ has order $r^3$.
\end{prop}

\begin{proof}
We will choose bases of $R$ and $I$ as $\Z$-modules, use them to write
down the matrix of the inclusion of $\Z$-modules $I\to R$, and use row
operations to compute the invariant factors of this matrix.

First we introduce some notation that will be useful.  Let
$\phi:\Z^r\to\Z^d$ be the homomorphism
$$\phi(a_1,\dots,a_r)=(a_1,\dots,a_r,a_1,\dots,a_r,\dots,a_1,\dots,a_r).$$
In words, $\phi$ simply repeats its argument $d/r$ times.  Let
$\psi:\Z^r\to\Z^{dr}$ be the homomorphism
$$\psi(a_1,\dots,a_r)=
\phi(a_1,\dots,a_r)\phi(a_2,a_3,\dots,a_r,a_1)\dots
\phi(a_r,a_1,\dots,a_{r-1}).$$ In words, $\psi$ rotates its argument
$r$ times and repeats each result $d/r$ times.  It will be convenient
to apply $\psi$ to an $s\times r$ matrix (by applying it to each row),
thus obtaining a map from $s\times r$ matrices to $s\times rd$
matrices.  We write $I_d$ for the $d\times d$ identity matrix, and
$\one_r$ for the vector $(1,1,\dots,1)$ with 1 repeated $r$ times.

As an ordered basis of $R$ we choose
$$1,\sigma,\dots,\sigma^{d-1},\tau,\sigma\tau,\dots,\sigma^{d-1}\tau,
\tau^2,\dots,\sigma^{d-1}\tau^{r-1}.$$
As ordered basis of $I$ we choose 
$$f_0,f_1,\dots,f_{d-1},d_1,\dots,d_{r-1},e_1,\dots,e_{r-1}.$$

With these notations, the first $d+r-1$ rows of the matrix of the
inclusion $I\to R$ have the form
$$\xymatrix{
I_d&I_d&I_d&\cdots&I_d&I_d\\
\phi(-\one_r)&\phi(\one_r)&0&\cdots&0&0\\
0&\phi(-\one_r)&\phi(\one_r)&\cdots&0&0\\
\vdots&\vdots&\vdots&\ddots&\vdots&\vdots\\
0&0&0&\cdots&\phi(-\one_r)&\phi(\one_r)
}$$
The last $r-1$ rows are $\psi$ applied the the $(r-1)\times r$ matrix:
%  TeX bug??
% with the \left and \right, thie size doubles
% ??
$$%\psi\left(
\xymatrix{-1&1&0&\cdots&0\\
0&-1&1&\cdots&0\\
\vdots&\vdots&\vdots&\ddots&\vdots\\
0&\cdots&0&-1&1}%\right)
$$
We refer to the rows by the names of the corresponding generators of
$I$.  Thus $f_i$ for $i=0,\dots,d-1$ refers to the first $d$
rows, $d_j$ for $j=1,\dots,r-1$ refers to the next $r-1$ rows, and
$e_j$ for $j=1,\dots,r-1$ refers to the last $r-1$ rows.

We now perform row operations on this matrix as follows.  First, we
replace row $d_1$ with 
$$d_1+\sum_i f_i+\sum_{j=2}^{r-1}jd_j$$
which has the effect of replacing row $d_1$ with
$$\xymatrix{0&0&0&\cdots&0&\phi(r\one_r).}$$

Next, we replace row $e_1$ with 
$$e_1+\sum_{j=2}^{r-1}je_j$$
which has the effect of replacing row $e_1$ with
$$\psi(-1,-1,\dots,-1,r-1).$$

Now we replace row $e_2$ with
$$\sum_{j=2}^{r-1}{j\choose 2}e_j$$
which has the effect of replacing row $e_2$ with
$$\psi\left(0,-1,-2,\dots,-(r-2),{r-1\choose2}\right).$$

Now we subtract a suitable combination of the $f_i$ rows from the
last $r-1$ rows so as to make the lower left $(r-1)\times d$ block
identically zero.  The last $r-1$ rows then take the form
$$\xymatrix{
\phi(0)&\phi(0,\dots,0,r,-r)&\phi(0,\dots,0,r,0,-r)&
\dots&\phi(r,0,\dots,0,-r)\\
\phi(0)&\phi(-1,-1,\dots,-1+{r\choose2},-1-\frac{r(r-3)}{2})&
\phi(-2,-2,\dots,-2+{r\choose2},-2+r,-2-\frac{r(r-3)}{2})&
\dots&\phi(1-r+{r\choose2},1,\dots,1,-(r-1)-\frac{r(r-3)}{2})\\
\phi(0)&\phi(0,-1,2,-1,0\dots,0)&\dots&&\\
\phi(0)&\phi(0,0,-1,2,-1,0\dots,0)&\dots&&\\
\vdots&&&&\\
\phi(0)&\phi(0,\dots,-1,2,-1)&\dots&&}$$

[Need a better way to format this ... see the code for the rest of the
picture.]

Now we replace row $e_2$ with  $e_2-\sum_{j=2}^{r-1}{j\choose 2}d_j$
which yields
$$\xymatrix{
\phi(0)&\phi(0,\dots,0,{r\choose2},-\frac{r(r-3)}{2})&
\phi(0,\dots,{r\choose2},r,-\frac{r(r-3)}{2})&
\phi(0,\dots,{r\choose2},r,r,-\frac{r(r-3)}{2})&
\dots&
\phi(0,-\frac{r(r-3)}{2},-\frac{r(r-3)}{2},\dots,-\frac{r(r-3)}{2},-r(r-2))}$$

[again, see the code]

We now divide into two cases according to the parity of $r$.  If $r$
is odd, we replace $e_2$ with 
$$e_2-\frac{(r-1)}2e_1+\frac{r-1}2d_1$$
which yields
$$\xymatrix{
\phi(0)&\phi(0,\dots,0,r)&\phi(0,\dots,r,r)&
\dots&\phi(0,r,\dots,r).}$$
Note that every entry in this vector is divisible by $r$.
Arranging the rows in the order
$$f_0,\dots,f_{d-1},d_2,e_3,\dots,e_{r-1},e_1,e_2,d_3,\dots,d_{r-1},d_1$$
yields a matrix in row echelon form and with the property that the
leading entry of each row divides every entry to the right.  Looking
at the leading terms then reveals that the invariant factors are $1$
repeated $d+2r-5$ times and $r$ repeated 3 times.  

Now we turn to the case when $r$ is even.  Replacing row $e_2$ with 
$$e_2-\frac r2e_1$$
yields
$$\xymatrix{
\phi(0)&\phi(0,\dots,0,-\frac r2,\frac{3r}2)&
\phi(0,\dots,-\frac r2,r,\frac{3r}2)&
\dots&\phi(-\frac{r^2}2,-\frac{r(r-3)}2,\dots.-\frac{r(r-3)}2,-\frac{r(r-4)}2).
}$$
Note that every entry in this vector is divisible by $r/2$.  

Now we replace $e_1$ with 
$$e_1+2e_2+(r-1)d_1$$
which yields
$$\xymatrix{
\phi(0) &\phi(0,\dots,0,2r)&\phi(0,\dots,0,2r,2r)&
\dots&\phi(0,2r,2r,\dots,2r).
}$$
Note that every entry in this vector is divisible by $2r$.  
Arranging the rows in the order
$$f_0,\dots,f_{d-1},d_2,e_3,\dots,e_{r-1},e_2,e_1,d_3,\dots,d_{r-1},d_1$$
yields a matrix in row echelon form and with the property that the
leading entry of each row divides every entry to the right.  Looking
at the leading terms then reveals that the invariant factors are $1$
repeated $d+2r-5$ times and $r/2$, $r$, and $2r$ each appearing once.

This completes the proof of the theorem.
\end{proof}


For later reference, we record the torsion classes provided by the
proof.
\begin{prop}\label{prop:torsion-in-R/I}
If $r$ is odd, the classes of 
$$\sum_i\sigma^i\qquad\sum_i\sigma^i\tau^{d-i}\quad\text{and}\quad
\sum_{j=0}^{r-1}\sum_{k=0}^{r-1-j}\sum_{i\equiv k\mod r}\sigma^i\tau^j$$
in $R/I$ are torsion of order $r$ and generate a group of order $r^3$.

If $r$ is even, the classes of
\begin{multline*}
\sum_i\sigma^i\qquad
\sum_{j=0}^{r-1}\sum_{k=0}^{r-1-j}\sum_{i\equiv k\mod r}\sigma^i\tau^j
\quad\text{and}\quad\\
-\sum_{j=0}^{r-2}\sum_{i\equiv r-1-j\mod r}\sigma^i\tau^j
+\sum_{i\not\equiv0\mod r}\sigma^i\tau^{r-1}
+2\sum_{j=1}^{r-1}\sum_{k=r-j}^{r-1}\sum_{i\equiv k\mod
  r}\sigma^i\tau^j
\end{multline*}
in $R/I$ are torsion of orders $r$, $2r$, and $r/2$ respectively, and
they generate a group of order $r^3$.
\end{prop}

\begin{proof}
After row reduction as above, the row $d_1$ proves that
$\sum_i\sigma^i\tau^{r-1}$ is $r$ torsion, and this is equivalent in
$R/I$ to $\sum_i\sigma^i$.

If $r$ is odd, the row $e_1$ shows that 
$$\sum_{j=1}^{r-1}\left(\sum_{i\equiv r-1-j\mod r}\sigma^i-
\sum_{i\equiv r-1\mod r}\sigma^i\right)\tau^j$$
is $r$-torsion.  Adding $\sum_{i\equiv r-1\mod r}f_i$ shows that this
is equivalent in $R/I$ to
$$\sum_{j=0}^{r-1}\sum_{i\equiv r-1-j\mod r}\sigma^i\tau^j$$
which in turn is equivalent to $\sum_i\sigma^i\tau^{d-i}$.
Also, the row $e_2$ shows that
$$\sum_{j=1}^{r-1}\sum_{k=r-j}^{r-1}\sum_{i\equiv k\mod r}\sigma^i\tau^j$$
is $r$ torsion.  The negative of this element is equivalent in $R/I$ to
$$\sum_{j=0}^{r-1}\sum_{k=0}^{r-1-j}\sum_{i\equiv k\mod r}\sigma^i\tau^j.$$

Since the three $r$-torsion elements just exhibited are associated to
distinct rows of a matrix in row echelon form, they are independent,
i.e., they generate a subgroup of order $r^3$.  This completes the
proof in the case $r$ is odd.

When $r$ is even, the proof for the first class is as in the case for $r$ odd. The relation from row $e_1$ shows that 
$$\sum _{j=1}^{r-1} \sum _{i=r-j}^{r-1} \sum _{i \equiv k\mod r} \sigma^i\tau^j$$
is $2r$-torsion.
Since $\sum _j \tau ^j = 0$ in $R/I$, the negative of this is equivalent to 
$$\sum_{j=0}^{r-1} \sum _{k=0}^{r-1-j} \sum_{i \equiv k\mod r} \sigma^i\tau^j.$$
The relation from row $e_2$, combined with the fact that $\sum _i \sigma ^i$ is $r$-torsion, shows that 

$$2 \sum _{j=1}^{r-1} \sum_{k=r-j}^{r-1} \sum _{i \equiv k \mod r} \sigma ^i \tau ^j + \sum _{i \equiv {r-1} \mod r}\sum _{j=0}^{r-1} \sigma ^i \tau ^j + \sum _{i \not \equiv 0\mod r} \sigma ^i \tau ^{r-1} - \sum _{j=0}^{r-2} \sum _{i \equiv r-1-j\mod{r}} \sigma ^i \tau ^j.$$
is $\frac{r}{2}$-torsion.   Again using the fact that $\sum _j \tau ^j = 0$ in $R/I$ the second term is zero, and the result follows. 

\end{proof}




\subsection{A rational splitting}
For notational simplicity, in this and the following subsection we
write $G$ for $\mu_d\times\mu_r$.  Let $R^0=R\tensor\Q=\Q[G]$ be the
rational group ring.  Because $G$ is abelian, the regular
representation of $R^0$ on itself breaks up into $\Q$-irreducibles
each appearing with multiplicity one.

% the irreducible are all cyclotomic fields indexed by divisors $s$ of $r$
% and $e$ of $d$ and by elements of $(\Z/\gcd(s,e)\Z)^\times$.
% If it is of use in computing invariants, we could add a 
% remark here about $R^0/I^0$ in these terms

Because of this multiplicity one, if $I^0$ is any ideal of $R^0$ and
$\pi:R^0\to R^0/I^0$ is the projection, then there is a unique
$G$-equivariant splitting $\rho:R^0/I^0\to R^0$.

We want to work this out explicitly in the case where $I$ is as in the
previous subsection and $I^0=I\tensor\Q$.
We write 
$$s_j=\sum_{i\equiv j\pmod r}\sigma^i,$$ 
so that
$$\sum_{i=0}^{d-1}\sigma^i\tau^{d-i}=\sum_{j=0}^{r-1}s_j\tau^{r-j}.$$
In Proposition $1.2$ we show that $\sum _i \sigma ^i$ is $r$-torsion in $R/I$, so that $\sum _i \sigma ^i = 0$ in $R^0/I^0$. Note also that

$$\sum _{i=0}^{d-1} \sigma ^i \tau ^{d-i} = \tau \sum _{i=0}^{d-1} \sigma ^i \tau ^{d-i} = \hdots = \tau ^{r-1} \sum _{i=0}^{d-1} \sigma ^i \tau ^{d-i} ,$$
so that  

$$r \sum _{j=0}^{r-1} s_j  \tau ^{r-j} = r \sum _{i=0}^{d-1} \sigma ^i \tau ^{d-i} = (1 + \tau + \hdots + \tau ^{r-1}) \sum _{i=0}^{d-1} \sigma ^i \tau ^{d-i} = 0,$$\\
in $R/I$, and $\sum _{j=0}^{r-1} s_j  \tau ^{r-j} = 0$ in $R^0/I^0$.\\ \\

\begin{lemma}
The unique $G$-equivariant splitting
$\rho:R^0/I^0\to R^0$ is given by
$$\rho(\sigma^a\tau^b)=
\sigma^a\tau^b\left(1+\frac2{rd}\sum_{i=0}^{d-1}\sigma^i\sum_{j=0}^{r-1}\tau^j-\frac1d \sum_{i=0}^{d-1}\sigma^i
-\frac1d\sum_{j=0}^{r-1}s_j\tau^{r-j}-\frac1r\sum_{j=0}^{r-1}\tau^j\right)$$
\end{lemma}

\begin{proof}
The only serious point is to check that $\rho$ is well
defined: the formula defines a $G$-equivariant map $R\to R$ and we
have to check that it kills the ideal $I$.  Once that is established,
it is obvious from the formula and the remarks just before the
statement that $\rho$ is a splitting.

To check well-definedness, we use the following easy identities in $R$:
\begin{align*}
\left(\sum_{i=0}^{d-1}\sigma^i\right)^2&=d \sum_{i=0}^{d-1}\sigma^i\\
\left(\sum_{i=0}^{d-1}\sigma^i\right)\left(\sum_{j=0}^{r-1}s_j\tau^{r-j}\right)
&=\frac dr \left(\sum_{i=0}^{d-1}\sigma^i\right)\left( \sum_{j=0}^{r-1}\tau^j\right)\\
\left(\sum_{j=0}^{r-1}s_j\tau^{r-j}\right)^2&=d \sum_{j=0}^{r-1}s_j\tau^{r-j}\\
\left(\sum_{j=0}^{r-1}\tau^j\right)^2&=r \sum_{j=0}^{r-1}\tau^j\\
\left(\sum_{j=0}^{r-1}\tau^j\right)\left(\sum_{j=0}^{r-1}s_j\tau^{r-j}\right)
&=\left(\sum_{i=0}^{d-1}\sigma^i\right)\left( \sum_{j=0}^{r-1}\tau^j\right)
\end{align*}

Using these, it is a quick computation to check that $\rho$ kills $I$.
\end{proof}

\subsection{A pairing}
Now we introduce an inner product on $R^0$ by declaring that
$$\left\langle\sum_g a_gg,\sum_gb_gg\right\rangle=\sum a_gb_g.$$
(In other words $\langle g,h\rangle=\delta_{gh}$.)
Crucially, this inner product is \emph{positive definite}.

Using the splitting $\rho$ we get an inner product on $R^0/I^0$ which
is also positive definite.  It is convenient for the calculation that
follows to note that if $\overline a$ and $\overline b$ are in $R^0/I^0$ and
if $b$ is any lift of $\overline b$ to $R^0$, then we have
$$\langle\rho(\overline a),\rho(\overline b)\rangle
=\langle\rho(\overline a),b\rangle.$$
(This follows from the fact that our pairing is $G$-invariant plus
multiplicity one.)

Using the previous observation, we see that computing the pairing on
$R^0/I^0$ amounts to reading off the coefficients of $\rho(1)$.  We
find that the pairing of $\sigma^i\tau^j$ and $1=\sigma^0\tau^0$ is
$1/(rd)$ times the following:
$$\begin{cases}
(r-1)(d-2)&\text{if $i=j=0$}\\
2-r&\text{if $i\not\equiv0\pmod r$, $j=0$}\\
2-2r&\text{if $i\equiv0\pmod r$, $i\not\equiv0\pmod d$, $j=0$}\\
2-d&\text{if $i=0$, $j\not\equiv0\pmod r$}\\
2&\text{if $i\not\equiv0\pmod d$, $j\not\equiv0\pmod r$, 
$i+j\not\equiv0\pmod r$}\\
2-r&\text{if $i\not\equiv0\pmod r$, $i+j\equiv0\pmod r$}
\end{cases}
$$

The last displayed formula may look familiar, and for good reason!  We
have a well-defined map $R^0/I^0\to J(K_d)\tensor\Q$ whose image is
(by definition) $V\tensor\Q$. This map sends $\sigma^i\tau^j$ to
$P_{ij}$.  We get a second pairing on $R^0/I^0$ by using the map to
$V\tensor\Q$ and the height pairing on $J(K_d)\tensor\Q$.  Comparing
this pairing with the one defined above shows that the are they same
up to a scalar: the height pairing is $(d-1)$ times the group
theoretic pairing.  More formally, we have shown the following.

\begin{prop}\label{prop:pairings}
For all $a,b\in R$, we have
$$\left\langle a(P_{00}),b(P_{00})\right\rangle = (d-1)\left\langle\rho(\overline{a}),\rho(\overline{b})\right\rangle$$
Here the left hand pairing is the height pairing on $J_r(K_d)$
\end{prop}

\begin{cor}\label{cor:rank-lower-bound}
  The map $(R/I)/tor\to V/tor$ is
  injective and therefore an isomorphism.  The rank of
  $V$ is thus $(r-1)(d-2)$.
\end{cor}

\begin{proof}
  The proposition shows that the the pairing on $(R/I)/tor$ induced by
  the homomorphism $(R/I)/tor\into R^0/I^0\to V\tensor\Q$ is positive
  definite.  It follows immediately that the homomorphism
  $(R/I)/tor\to V/tor$ is injective, and it is surjective by the
  definition of $V$, so it is an isomorphism.
\end{proof}


\subsection{Determinants}
With notation as above, let $W=R/I$.  We defined a canonical
$G$-equivariant splitting $\rho:W\to R^0$ above and
defined a pairing on $W$ by $\langle w_1,w_2\rangle=\langle
\rho(w_1),\rho(w_2)\rangle$ where the second pairing is the
Euclidean pairing on $R^0$.  We then checked that up to a scalar
($d-1$), this pairing on $W$ is the canonical height pairing on $V$.

Write $\det(W/tor)$ for the discriminant of this pairing on $W$ modulo
torsion and $\det(I)$ for the discriminant of the pairing on $I$
induced by that on $R$.

\begin{prop}
$$\det(I)=\frac{|W_{tor}|^2}{\det(W/tor)}$$
\end{prop}

\begin{proof}
First suppose that $I$ is saturated, i.e., that $W$ is torsion free.
Let $e_1,\dots,e_k$ be a $\Z$-basis of $I$ and extend it to a
$\Z$-basis $e_1,\dots,e_n$ of $R$.  Write $\overline e_i$ for the
image of $e_i$ in $W$, so that $\overline e_{k+1},\dots,\overline e_n$
is a $\Z$-basis of $W$.  Because the pairing on $R$ is the Euclidean
pairing, the discriminant 
$$\left|\det\left(\langle e_i,e_j\rangle\right)\right|=1.$$
Now let 
$$f_i=\begin{cases}
e_i&\text{if $i\le k$}\\
\rho(\overline e_i)&\text{if $i>k$.}
\end{cases}
$$
This is a $\Q$-basis of $R^0$.  The change of basis matrix is upper
triangular with 1's on the diagonal, so it has determinant 1 and we
have
$$\left|\det\left(\langle f_i,f_j\rangle\right)\right|=
\left|\det\left(\langle e_i,e_j\rangle\right)\right|=1.$$ Now
$\rho(W)$ is orthogonal to $I$, so the new Gram matrix
$\left(\langle f_i,f_j\rangle\right)$ is block diagonal.  Its upper left
$k\times k$ block is just $\left(\langle e_i,e_j\rangle\right)$ and
the determinant of this block is $\pm\det(I)$.  The lower right
$(n-k)\times(n-k)$ block is just $\left(\langle \rho(\overline
  e_i),\rho(\overline e_j)\rangle\right)$ and the determinant of
this block is $\pm\det(W)=\pm\det(W/tor)$.  Thus these two
discriminants are reciprocal and this proves our claim in the case when
$I$ is saturated.

For general $I$, let $I'$ be the saturation, so that $|I'/I|=|W_{tor}|$
and $R/I'=W/tor$.  Then 
$$\det(I)=|I'/I|^2\det(I')=|W_{tor}|^2\det(I')=\frac{|W_{tor}|^2}{\det(W/tor)}$$
as desired.\
\end{proof}


\begin{prop}
$$\det(I)=r^{d+2}d^{2r-2}$$
\end{prop}


\begin{proof}
It is not hard to check that the following is a $\Z$-basis for $I$:
\begin{align*}
\alpha_i&=\sigma^i\sum \tau^j\qquad i=0,\dots,d-1\\
\beta_j&=(\tau^j-1)\sum \sigma^i\qquad j=1,\dots,r-1\\
\gamma_j&=(\tau^j-1)\sum \sigma^i\tau^{d-i}\qquad j=1,\dots,r-1.
\end{align*}

We have pairings 
\begin{align*}
\langle\alpha_i,\alpha_{i'}\rangle&=r\delta_{ii'}\\ 
\langle\alpha_i,\beta_j\rangle&=0\\ 
\langle\alpha_i,\gamma_j\rangle&=0\\ 
\langle\beta_j,\beta_{j'}\rangle&=d(\delta_{jj'}+1)\\ 
\langle\beta_j,\gamma_{j'}\rangle&=0\\
\langle\gamma_j,\gamma_{j'}\rangle&=d(\delta_{jj'}+1)
\end{align*}
so the Gram matrix for this basis of $I$ is block diagonal.  An
inductive argument shows that if $A$ is the sum of an identity matrix
of size $a\times a$ and a matrix of the same size with all entries 1,
then $\det(A)=a+1$.  Thus we find
$$\det(I)=r^{d+2}d^{2r-2}$$
as desired.
\end{proof}

Using the caclulation of $W_{tor}$ in
Proposition~\ref{prop:R/I-as-group}, we find the determinant of
$W/tor$.

\begin{cor}\label{cor:det(W/tor)}
Recall that $W=R/I$.  We have
$$\det(W/tor)=r^{4-d}d^{2-2r}.$$
\end{cor}



\subsection{$R/I$ and $V$}

\begin{lemma}[Missing lemma]\label{lemma:missing}
The homomorphism $W_{tor}\to V\subset J_r(K_d)$ is injective.
\end{lemma}


\begin{thm}
The projection $R/I\to V$ is an isomorphism.
\end{thm}

\begin{proof}
Write $W$ for $R/I$.  We have a commutative diagram with exact rows:
$$\xymatrix{
  0\ar[r]&W_{tor}\ar[r]\ar[d]&W\ar[r]\ar[d]&W/W_{tor}\ar[r]\ar[d]&0\\
  0\ar[r]&V_{tor}\ar[r]&V\ar[r]&V/V_{tor}\ar[r]&0}$$ 
The middle vertical arrow is surjective, thus so is the right vertical
arrow.  By Corollary~\ref{cor:rank-lower-bound}, the right vertical
arrow is injective, so it is an isomorphism.  The snake lemma then
shows that the left vertical arrow is surjective.  By
Lemma~\ref{lemma:missing} it is injective too, so an isomorphism.  Now
another application of the snake lemma shows the middle vertical arrow
is an isomorphism.
\end{proof}

\begin{cor}
$$\det(V/tor)=(d-1)^{(r-1)(d-2)}r^{4-d}d^{2-2r}$$
\end{cor}

\begin{proof}
  Use the theorem and Corollary~\ref{cor:det(W/tor)}, keeping in mind
  the scalar $(d-1)$ relating the group-theoretic and height pairings
  as in Proposition~\ref{prop:pairings}.
\end{proof}

\subsection{Summary}
Altogether, we have shown the following.
\begin{thm}
  The subgroup $V$ of $J_r(K_d)$ generated by the $P_{ij}$ is
  isomorphic as $R$-module to $R/I$.  It has $\Z$-rank $(r-1)(d-2)$ and
  $\Z$-torsion of order $r^3$.  Its discriminant with respect to the height
  pairing is
$$\det(V/tor)=(d-1)^{(r-1)(d-2)}r^{4-d}d^{2-2r}.$$
\end{thm}


\section{Visible vs Mordell-Weil}
In this section, we will analyze the
relationship between $V$ and $J_r(K_d)$.

By an earlier conductor calculation, we know the rank of $J_r(K_d)$ is
at most $(r-1)(d-2)$, so our lower bound on the rank of $V$ shows
that this is the exact value of the rank, and it shows that $V$ has
finite index in $J_r(K_d)$.

\begin{thm}
  The torsion subgroup $J(K_d)_{tor}$ is equal to $V_{tor}$ and has
  order $r^3$.  The index of $V$ in $J_r(K_d)$ is a power of $p$.
\end{thm}

\begin{proof}
Let $\det(J)$ be the determinant of the height pairing on
$J_r(K_d)/tor$ and let $J_{tor}=J_r(K_d)_{tor}$.  Then we have
$$\frac{\det(J)}{|J_{tor}|^2}=\frac1{[J_r(K_d):V]^{2}}\frac{\det(V/tor)}{|V_{tor}|^2}.$$

On the other hand, for each place $v$ of $K_d$, let $f_v$ be the order
of the component group of the N\'eron model of $J$ at $v$.  Then the
rational number
$$\frac{\det(J)}{|J_{tor}|^2}\prod_v f_v$$
is an integer.  This is implicit in [Gordon, Compositio {\bf 38},
\S5].  A detailed proof in the case where $J$ has genus 1 was given in
[Legendre 9.1] and the same proof works verbatim in the context of
this paper.  [We should remark that the discriminant of the local
pairing in [Legendre 9.1] and the order of the local component group
here are the same by Grothendieck's calculation of the component group
from the minimal model of the curve.  We can use this to compute the
order of the component groups.]

Plugging in the orders of the component groups and our results on $V$,
we find that 
$$\frac{(d-1)^{(r-1)(d-2)}}{[J_r(K_d):V]^2}$$
is an integer.  Since $d=p^f+1$, this shows that the index is a power
of $p$.  Also, we know that $J_r(K_d)$ has no $p$-torsion, so
$J_r(K_d)_{tor}=V_{tor}$.  This completes the proof of the theorem.
\end{proof}

\section{Index and $\sha$}

[The Tamagawa number is the product of the orders of the component
groups times a certain power of $p$ determined by differentials.  Most
of what we need to compute the latter is in the $p$-torsion section.]

Using the BSD formula and the results above, we find
\begin{thm}
$$|\sha(J_r/K_d)|=[J_r(K_d):V]^2.$$
\end{thm}



\begin{thebibliography}{BLR90}

\bibitem{bosch-liu1999}
Siegfried Bosch and Qing Liu.
\newblock Rational points of the group of components of a {N}\'eron model.
\newblock {\em Manuscripta Math.}, 98(3):275--293, 1999.

\bibitem{blr}
Siegfried Bosch, Werner L{\"u}tkebohmert, and Michel Raynaud.
\newblock {\em N\'eron models}, volume~21 of {\em Ergebnisse der Mathematik und
  ihrer Grenzgebiete (3) [Results in Mathematics and Related Areas (3)]}.
\newblock Springer-Verlag, Berlin, 1990.

\bibitem{bps}
Nils Bruin, Bjorn Poonen, and Michael Stoll.
\newblock Generalized explicit descent and its application to curves of genus 3.
\newblock \url{http://arxiv.org/abs/1205.4456}, 2012.


%\bibitem[C01]{Cornelissen}
%Gunther Cornelissen.  
%\newblock Two-torsion in the Jacobian of hyperelliptic curves over finite fields. 
%\newblock {\em Arch.\ Math.\ (Basel)} {\bf 77} (2001), no.\ 3, 241Ð-246.

\bibitem{lorenzini}
Dino Lorenzini.
\newblock Arithmetical graphs.
\newblock Math.\ Annalen 285, 481--502, 1989.

\bibitem{ps}
Bjorn Poonen and Edward F.\ Schaefer.
\newblock  Explicit descent for Jacobians of cyclic covers of the projective line.
\newblock   J.\ Reine Angew.\ Math.\ 488, 141--188, 1997.

\bibitem{silvermanATAEC}
Joseph~H.\ Silverman.
\newblock {\em Advanced topics in the arithmetic of elliptic curves}.
\newblock Springer-Verlag, New York, 1994.

\bibitem{Legendre}
Douglas Ulmer.
\newblock Explicit points on the Legendre curve.
\newblock \url{http://arxiv.org/abs/1002.3313}.

\end{thebibliography}

\end{document}